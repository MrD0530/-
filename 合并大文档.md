## Linux 文件管理基础

*   **当前工作目录**：当前在文件系统中所处的位置。
*     **路径**：
    *   **绝对路径**：从根目录 `/` 开始的完整路径，如 `/etc/passwd`  `/home/dir1/passwd`
    *   **相对路径**：相对于当前工作目录的路径，如 `./yangge.txt` (当前目录) 或 `../home/alice` (上级目录)
    *   ==**root 用户的家目录就是 /root**==

<img src="assets/FSH.png" alt="FSH" style="zoom: 88%;" />

### 一、 导航与查看

#### 1. `pwd` - 打印当前工作目录
**功能**：显示当前所在的目录的绝对路径。
**案例**：

```bash
[root@tianyun ~]# pwd
/root
```

#### 2. `ls` - 列出目录内容
**功能**：列出指定目录下的文件和子目录。
**常用选项**：

*   `-l`：以长格式（详细信息）列出。
*   `-a`：显示所有文件，包括隐藏文件（以 `.` 开头的文件）。
*   `-h`：与 `-l` 一起使用，以人类可读的格式（如 K, M, G）显示文件大小。
*   `-t`：按修改时间排序，最新的在前。
*   `-S`：按文件大小排序，最大的在前。
*   `-d`：查看目录本身的信息

**案例**：

```bash
# 列出当前目录内容（包括隐藏文件）
[root@tianyun ~]# ls -a
.              .bash_logout   .cache      .lesshst    .msmtprc  .pki              .tcshrc
..             .bash_profile  .cshrc      .mailrc     .muttrc   .pydistutils.cfg  .viminfo
.bash_history  .bashrc        .msmtp.log  .pip        .ssh

# 以详细信息列出当前目录所有内容（包括隐藏文件）
[root@tianyun ~]# ls -al
dr-xr-x---.  6 root root  4096 Sep  5 17:21 .
dr-xr-xr-x. 19 root root  4096 Aug  8 14:47 ..
-rw-------   1 root root 22119 Sep  5 16:19 .bash_history
-rw-r--r--.  1 root root    18 Dec 29  2013 .bash_logout
-rw-r--r--.  1 root root   176 Dec 29  2013 .bash_profile
-rw-r--r--.  1 root root   176 Dec 29  2013 .bashrc
drwx------   3 root root  4096 Jun 28  2024 .cache
...

# 以详细信息且易读的方式列出 /var/log 目录的内容
[root@tianyun ~]# ls -lh /var/log
total 3.0M
drwxr-xr-x. 2 root   root            4.0K Jun 28  2024 anaconda
drwx------. 2 root   root            4.0K Aug 27 08:18 audit
-rw-r--r--  1 root   root             108 Aug 17 09:59 backup_script.log
-rw-------  1 root   root               0 Aug 12 03:37 boot.log
-rw-------  1 root   root             30K Aug  9 03:25 boot.log-20250809
-rw-------  1 root   root             26K Aug 12 03:37 boot.log-20250812
-rw-----
--  1 root   utmp             384 Sep  5 16:59 btmp
-rw-------  1 root   utmp             384 Sep  5 15:59 btmp-20250905
drwxr-xr-x. 2 chrony chrony          4.0K Aug  8  2019 chrony
-rw-r--r--  1 root   root               0 Jun 28  2024 cloudinit-deploy.log
...

# 以详细的方式查看文件 /etc/passwd
[yangge@tianyun ~]$ ls -l /etc/passwd
-rw-r--r--. 1 root root 2310 Sep  9 10:29 /etc/passwd

# 以详细的方式查看目录下的文件 /var
[yangge@tianyun ~]$ ls -l /var/
drwxr-xr-x.  2 root root   19 Sep  9 10:26 account
drwxr-xr-x.  2 root root    6 Apr 11  2018 adm
drwxr-xr-x. 13 root root  159 Sep  9 10:31 cache
drwxr-xr-x.  2 root root    6 Oct  2  2020 crash

# 以详细的方式查看目录本身
[yangge@tianyun ~]$ ls -ld /var/
drwxr-xr-x. 21 root root 4096 Sep  9 10:30 /var/
```

#### 3. `cd` - 切换目录
**功能**：改变当前工作目录。
**特殊符号**：

*   `~` 代表用户的家目录（如 `/root` ` /home/yangge`）
*   `..` 代表上级目录
*   `.` 代表当前目录
*   `-` 切换到上一个工作目录（类似于 "返回" ）

**案例**：

```bash
# 切换到绝对路径 /etc/sysconfig/network-scripts/ 目录
[root@tianyun ~]# cd /etc/sysconfig/network-scripts/
[root@tianyun network-scripts]# pwd
/etc/sysconfig/network-scripts

# 切换到用户家目录 cd ~ 或 直接cd
[root@tianyun network-scripts]# cd ~
[root@tianyun ~]# pwd
/root

# 切换到根目录
[root@tianyun ~]# cd /
[root@tianyun /]# 

# 相对路径切换到 etc目录（当前在/目录）
[root@tianyun /]# cd etc/
[root@tianyun etc]# 

# 切换到上级目录
[root@tianyun etc]# cd ..
[root@tianyun /]# 

# 切换到上一个所在的目录
[root@tianyun ~]# cd /etc/sysconfig/network-scripts/
[root@tianyun network-scripts]# cd
[root@tianyun ~]# cd -
/etc/sysconfig/network-scripts
```

---

### 二、 文件与目录操作

#### 4. `mkdir` - 创建目录
**功能**：创建新的目录
**常用选项**：

*   `-p`：递归创建所有不存在的父目录

**案例**：

```bash
# 在当前目录下创建一个名为 dir1 的目录
$ mkdir dir1

# 在当前目录下创建三个目录 dir2 dir3 backup
$ mkdir dir2 dir3 backup

# 递归目录 /tmp/dir4
$ mkdir /tmp/dir4

# 递归创建目录结构 dir1/docs/images
$ mkdir -p dir1/docs/images
```

#### 5. `touch` - 创建空文件或更新时间戳
**功能**：1. 如果文件不存在，则创建一个新的空文件。2. 如果文件存在，则更新其访问和修改==时间戳==
**案例**：

```bash
# 创建两个空文件 file1.txt 和 file2.txt
$ touch file1.txt file2.txt

# 更新 file1.txt 的时间戳为当前时间
$ touch file1.txt

# {}的用法，在dir3目录下创建10个文件
$ touch dir3/file{1..10}

# {}的用法，在dir3目录下创建2个文件
$ touch dir3/yangge{1,10}
```

#### 6. `cp` - 复制文件或目录
**功能**：复制文件或目录。
**常用选项**：
*   `-r` 或 `-R`：递归复制目录及其所有内容
*   `-i`：覆盖前提示确认（交互模式）
*   `-v`：显示复制过程的详细信息（冗长模式）
*   `-f`：强制force，不会提示

**案例**：
```bash
# 将 file1.txt 复制到当前目录，并命名为 file1_backup.txt
$ cp file1.txt file1_backup.txt

# 将 file1.txt 复制到 /tmp 目录
$ cp file1.txt /tmp/
$ cp file1.txt /tmp/file1_new.txt

# 递归复制整个 dir1 目录到 /tmp 目录
$ cp -r dir1 /tmp/

- 扩展：
# 将 /etc/passwd 复制到 /tmp
[yangge@tianyun ~]$ cp /etc/passwd /tmp/

# 将 /etc/passwd 复制到 当前目录（.）
[yangge@tianyun ~]$ cp /etc/passwd .

# 将 /etc/hosts /etc/fstab 复制到 当前目录（.）
[yangge@tianyun ~]$ cp /etc/hosts /etc/fstab ./
```

#### 7. `mv` - 移动或重命名文件/目录
**功能**：1. 移动文件或目录。2. 重命名文件或目录。（在 Linux 中，重命名被视为移动）
**常用选项**：

*   `-i`：覆盖前提示确认

**案例**：

```bash
# 将 file1.txt 重命名为 data.txt (在同一目录下移动即为重命名)
$ mv file1.txt data.txt

# 将 data.txt 文件移动到 dir1/docs/ 目录下
$ mv data.txt dir1/docs/

# 将 dir1 目录移动到 /var/tmp/ 目录下
$ mv dir1 /var/tmp/

# 将所有 .txt 文件移动到 /var/tmp/ 目录
$ mv *.txt /var/tmp/
```

#### 8. `rm` - 删除文件或目录
**功能**：删除文件或目录。**⚠️警告：此命令删除的文件通常无法恢复！**
**常用选项**：

*   `-r` 或 `-R`：递归删除目录及其所有内容。
*   `-f`：强制删除，忽略不存在的文件，不提示确认。（**极其危险！**）
*   `-i`：交互模式，删除前逐一确认。

**案例**：
```bash
# 列出 /var/tmp 的文件
$ ls /var/tmp/
dir1
file1_backup.txt
file2.txt

# 列出当前目录下所有文件
$ ls
backup   
dir2
dir3

# 删除 /var/tmp/file2.txt 文件
$ rm /var/tmp/file2.txt

# 交互式地删除 /tmp/ 下所有 .txt 文件
$ rm -i /tmp/*.txt

# 递归删除 /var/tmp/dir1/ 目录及其下的所有内容
$ rm -r /var/tmp/dir1/

# 删除当前目录下 backup dir2 dir3
$ rm -r dir* backup

# 危险命令！强制递归删除所有内容，无提示（如果是root用户）
$ rm -rf /
```

#### 9. `rmdir` - 删除空目录
**功能**：删除空的目录。相比 `rm -r` 更安全，因为它只删除空目录。
**案例**：
```bash
$ mkdir /tmp/dir4

$ ls /tmp/
dir1
dir4
...

# 删除空目录 /tmp/dir4
$ rmdir /tmp/dir4

# 如果目录非空，命令会报错
$ rmdir /tmp/dir1
rmdir: failed to remove ‘/tmp/dir1’: Directory not empty

$ rm -r /tmp/dir1/
```

---

### 三、 查看文件内容

#### 10. `cat` - 查看文件内容
**功能**：一次性显示整个文件内容到终端。适合查看**小文件**。
**案例**：

```bash
# 查看 /etc/hosts 文件的内容
$ cat /etc/hosts

# 查看 /etc/redhat-release 文件的内容
$ cat /etc/redhat-release 

# 查看 /etc/sysconfig/network-scripts/ifcfg-ens33 文件的内容
$ cat /etc/sysconfig/network-scripts/ifcfg-ens33 

# 将 /etc/hosts 和 /etc/redhat-release 的内容合并后输出
$ cat /etc/hosts /etc/redhat-release
$ cat /etc/hosts /etc/redhat-release > newfile 【借用】

# 查看 /etc/sysconfig/network-scripts/ifcfg-ens33 文件的内容，并显示行号
$ cat -n /etc/sysconfig/network-scripts/ifcfg-ens33 

# 查看 /etc/passwd 文件的内容【由于内容太长，不适合使用cat查看文件内容】
$ cat /etc/passwd 
```

#### 11. `less` / `more` - 分页查看文件内容
**功能**：一页一页地查看文件内容，适合查看**大文件**。`less` 比 `more` 功能更强大（支持上下滚动、搜索等），是首选。
**案例**：

```bash
# 使用 less 查看大型日志文件
$ less /var/log/messages
```
在 `less` 视图中：
*   按 ==空格键==向下翻一页。
*   按 ==b== 向上翻一页。
*   按 ==上下箭头== 逐行移动。
*   按 ==/==后输入关键词进行搜索（按 `n` 查找下一个，`N` 查找上一个）。
*   按 ==q== 退出。

#### 12. `head` - 显示文件开头部分
**功能**：默认显示文件的前 10 行。
**常用选项**：
*   `-n <行数>`：指定显示的行数。

**案例**：
```bash
- 显示 messages 文件的前 10 行
# head /var/log/messages

- 显示 messages 文件的前 5 行
# head -n 5 /var/log/messages

- 显示 passwd 文件的前 10 行
# head /etc/passwd
```

#### 13. `tail` - 显示文件末尾部分
**功能**：默认显示文件的最后 10 行。常用于**实时查看日志**。
**常用选项**：

*   `-n <行数>`：指定显示的行数。
*   `-f`：实时追踪文件末尾的新内容（**监控日志的神器**）。按 `Ctrl+C` 退出。

**案例**：

```bash
- 显示 passwd 文件的后 10 行
# tail /etc/passwd

- 显示 messages 文件的最后 20 行
# tail -n 20 /var/log/messages

- 实时监控 secure 日志文件的更新
$ tail -f /var/log/secure
```

---

### 四、编辑文件内容

#### 14. `vi` - 强大的文本编辑工具

Vim（**Vi IMproved**）是 Unix 系统上经典编辑器 `vi` 的增强版。

1. **无处不在**：预装在几乎所有的 Linux 和 macOS 系统上，是系统管理和故障排查的终极利器。
2. **高效强大**：完全基于键盘操作，手不用离开 **主键区**，编辑效率极高。
3. **高度可定制**：通过 `.vimrc` 配置文件和各种插件，可以打造专属的 IDE。
4. **模态编辑**：这是 Vim 的核心特色，也是初学者最大的障碍。

<img src="assets/vim四种模式.png" style="zoom:88%;" />

```bash
# 准备练习文件
$ ls -al > /tmp/yangge.txt
$ cat /tmp/yangge.txt 
dr-xr-x---.  6 root root  4096 Sep  6 20:48 .
dr-xr-xr-x. 19 root root  4096 Sep  5 18:03 ..
-rw-------   1 root root 26258 Sep  5 20:42 .bash_history
-rw-r--r--.  1 root root    18 Dec 29  2013 .bash_logout
-rw-r--r--.  1 root root   176 Dec 29  2013 .bash_profile
-rw-r--r--.  1 root root   176 Dec 29  2013 .bashrc
drwx------   3 root root  4096 Jun 28  2024 .cache
-rw-r--r--.  1 root root   100 Dec 29  2013 .cshrc
-rw-------   1 root root    43 Aug 19 16:21 .lesshst
-rw-r--r--   1 root root   170 Aug 16 19:49 .mailrc
-rw-r--r--   1 root root  4494 Mar 17  1982 .msmtp.log
-rw-------   1 root root   183 Aug 19 17:20 .msmtprc
-rw-r--r--   1 root root   133 Aug 19 17:28 .muttrc
drwxr-xr-x   2 root root  4096 Jun 28  2024 .pip
drwxr-----   3 root root  4096 Aug  8 14:23 .pki
-rw-r--r--   1 root root   206 Aug  8 11:03 .pydistutils.cfg
drwx------   2 root root  4096 Jun 28  2024 .ssh
-rw-r--r--.  1 root root   129 Dec 29  2013 .tcshrc
-rw-------   1 root root  6068 Sep  6 20:34 .viminfo
```

##### 模式一：命令模式 - **指挥中心**

Vim 的**默认模式**和核心。所有其他操作都从这里开始，并最终回到这里。在这个模式下，键盘不是用来打字的，而是向编辑器**发号施令**。

**核心功能**：移动光标、复制、粘贴、删除、撤销、查找等。

**1. 光标移动 (Navigation):**

*   **基础移动**：`h` (左), `j` (下), `k` (上), `l` (右)
*   **行移动**：==0 (行首), $ (行尾)==
*   **屏幕移动**：==gg文件头, G末行行首==, `:n` 或 `nG` (跳至第n行)

**2. 删除 (Delete - `d`):**

*   `x` - 删除当前字符
*   `dw` - 删除一个单词
*   ==dd - 删除整行 不留空行(最常用)==
*   `d$` - 删除至行尾，有空行 
*   `dG` - 删除至文件末尾
*   `d}` - 删除至段落尾  
*   `3dd` - 往后删除3行 (数字+命令，表示重复执行)
*   `:3d`- 删除第3行
*   `D` - 删除至行尾,有空行
*   `dgg` - 删除至文件头

**3. 复制 (Yank - `y`) & 粘贴 (Paste - `p`):**

*   `yy` - ==**复制整行**== (最常用)
*   `yw` - 复制一个单词
*   `y$` - 复制至行尾  
*   `3yy` - 复制3行 (数字+命令，表示重复执行)
*   `p` - 粘贴到光标==**后**==
*   `P` - 粘贴到光标==**前**==

**4. 撤销与重做 (Undo/Redo):**

*   `u` - **撤销**上一次操作
*   `Ctrl + r` - **重做**，即撤销掉刚才的撤销

**5. 查找内容**

*   **正向查找：==/==：从光标位置开始**向==文件末尾==搜索
*   **反向查找：==?== (问号)**：从光标位置开始**向==文件开头==**搜索

**6. 进入其他模式:**

*   `i, a, o, s, I, A, O, S` -> **编辑模式**
*   `v, V, Ctrl+v` -> **可视模式**
*   `:` -> **扩展命令模式**

---

##### 模式二：编辑模式 - **写作台**

这是最容易被理解的模式，类似于普通文本编辑器，在这个模式下输入文本。

**进入方式 (从命令模式):**
*   `i` - **i**nsert，在光标前插入【推荐】
*   `a` - **a**ppend，在光标后插入
*   `o` - 在当前行的==**下方**==插入新行【推荐】
*   `O` - 在当前行的==**上方**==插入新行
*   `I` - 在行首插入
*   `A` - 在行尾插入

**退出方式：**
*   `Esc`  -> 退回**命令模式**

**技巧**：在编辑模式下，可以使用 `Ctrl + n` / `Ctrl + p` 进行单词补全。

---

##### 模式三：扩展命令模式 - **控制台**

通过在命令模式下按 `:` 进入。光标会移动到窗口底部的命令行，用于执行复杂命令、文件操作、配置设置等。

**进入方式**：在命令模式下按 `:`

**常用命令：**

**1. 文件操作:**

*   `:w` - **w**rite，保存文件
*   `:q` - **q**uit，退出 (如果文件未修改)
*   `:wq` 或 `:x` - 保存并退出
*   `:q!` - 强制退出，**不保存修改！**
*   `:w <path>` - 另存为，例如 `:w /var/tmp/file1.txt`

**2. 搜索与替换:**

*   :/keyword-向后搜索keyword，按n下一个，N上一个  
*   · :?keyword - 向前搜索 keyword  
*   `:%s/old/new/g` - ==**全局替换**==。将文件中所有的 `old` 替换为 `new`
    *   `%` -  全文，查找范围为1,$
    *   `s` 字符串
    *   `g` - global，一行内所有匹配项，如果不加`g` ，只替换该行中第一个
    *   `gc`  - global with confirm，每次替换前确认
    *   ==:10,20s/old/new/g== - 只在第10到20行之间替换

**3. 配置vim工作环境（临时）及其它命令:**

*   `:set nu` - 显示行号 (**set number**)
*   `:set nonu` - 隐藏行号
*   `:set ic` - 搜索时忽略大小写 (**ignore case**)
*   `:!<command>` - 执行外部 shell 命令 (如 `:!ls`)
*   `:noh` 去掉高亮显示
*   `:set cul` - 高亮显示光标所在的行（**cursorline**）
*   `:set cuc` - 高亮显示光标所在的列（**cursorcolumn**）
*   `:set list` - 显示非常规字符，例如换行符$
*   `:set ai` - 自动缩进（**autoindent**）

**退出方式**：命令执行后自动退回命令模式，或按 `Esc` 取消输入的命令。

---

##### 模式四：可视模式  - **选择工具**

类似于用鼠标选择文本，但更精确、更强大。先选择高亮区域，再对选区执行命令。

**进入方式 (从命令模式):**
*   `v` - **字符可视模式**。以字符为单位选择。
*   `V` - **行可视模式**。以行为单位选择。
*   `Ctrl + v` - **块可视模式** (列模式)。可以选择一个矩形文本块，极其强大。

**操作方式**：进入可视模式后，用移动命令（`h,j,k,l` 等）来扩大或缩小选择范围。

**对选区执行命令 (与命令模式命令通用):**
*   ==d - 删除选区==
*   ==y - 复制选区==
*   ==c -删除选区并进入编辑模式==  
*   ==:  -对选区**行**执行扩展命令 (如 :s/old/new/g 只替换选区内内容)==
*   `u` - 将选区字母转为小写
*   `U` - 将选区字母转为大写

**退出方式**：按 `Esc` 退回命令模式，或直接执行命令（如按 `d` 删除后）自动退回。

#### vi进阶实用技巧

1. 分屏操作

o :sp 路径+filename -水平分屏打开另一个文件  
o :vsp 路径+filename -垂直分屏打开另一个文件  
o Ctrl + ww - 在多个窗口间切换光标

2. 打开多个文件

```bash
vim file1.txt file2.txt # 同时打开多个文件
```

o :n - 编辑下一个文件 ,与w组合使用(保存)

o :N - 编辑上一个文件,与w组合使用（保存）

3.执行外部命令

   :!ls - 暂时离开 Vim 执行 ls 命令，按回车返回 Vim

4. 读入文件内容或命令输出

o :r filename -将另一个文件的内容插入到光标下方  
o :r  !ls - 将 ls 命令的输出结果插入到光标下方

------

##### vi使用环境配置

**创建 `~/.vimrc` 文件**，这是 Vim 的用户配置文件，可以极大提升使用体验。

```bash
$ vim ~/.vimrc
" 显示行号
set number

" 忽略大小写
set ignorecase

" 高亮光标所在行
set cursorline

" 主亮光标所在列
" set cursorcolumn

" 启用语法和文件类型检测
filetype on

" 启用基于文件类型的缩进规则
filetype indent on

" 启用基础自动缩进（保底方案）
set autoindent

- 显示匹配的括号  
set showmatch
```

```bash
filetype indent on (非常重要)
当前 Vim 缩进的黄金标准。它会根据正在编辑的文件类型（如 python, java, html）自动加载对应的、高度优化的缩进规则。这些规则远比 smartindent 智能。
```

##### vi 学习秘籍心法

1.  **命令模式是家**：无论你在做什么，`Esc` 键都能让你安全回家。任何不确定的时候，狂按 `Esc`。
2.  **模式切换是灵魂**：高效的 Vim 使用就是在这四个模式间流畅地切换：`命令模式 -> (编辑/可视/扩展模式) -> 命令模式`。
3.  **组合威力**：Vim 的命令可以组合，如 `d`(删除) + `w`(单词) = `dw`(删除一个单词)。`数字 + 命令` 表示重复，如 `3dd` 删除3行。
4.  **一个一个学**：不要试图一次性记住所有命令。先掌握生存技能（`i`, `dd`, `yy`, `p`, `u`, `:wq`），再逐步扩展。
5.  **不要灰心**：一开始会觉得别扭，这是正常的。一旦肌肉记忆形成，你的编辑速度将远超鼠标操作。

### 五、文件打包及压缩

**Linux打包压缩工具概览**

| 工具  | 文件扩展名 | 特点                   |
| ----- | ---------- | ---------------------- |
| tar   | .tar       | 仅打包不压缩           |
| gzip  | .gz        | 压缩速度快，压缩率一般 |
| bzip2 | .bz2       | 压缩率高，速度较慢     |
| xz    | .xz        | 高压缩率，速度慢       |
| zip   | .zip       | 跨平台兼容性好         |

#### 15. tar - 王者级打包压缩

##### 一打包压缩

- 仅打包不压缩
- 语法：==tar -cvf 指定的路径/文件 要打包的东西==

```bash
[root@tianyun ~]# tar -cvf etc.tar /etc
```

- -c：创建归档  
- -v：显示详细过程  
- -f：指定归档文件名



- 打包并使用 gzip 压缩
- ==-z：使用gzip压缩==
- 语法：==tar -czf 指定的路径/文件 要打包的东西==

```bash
[root@tianyun ~]#time tar -czf etc.tar.gz /etc
```



- ==-j：使用bzip2压缩==
- ==需要提前下载bzip2==
- 语法：==tar -cjf 指定的路径/文件 要打包的东西==

```bash
打包并使用 bzip2 压缩(需要提前下载)
[root@tianyun ~]# yum -y install bzip2
[root@tianyun ~]# time tar -cjf etc.tar.bz2 /etc
```



- ==-J：使用xz压缩==
- 语法：==tar -cJf 指定的路径/文件 要打包的东西==

```bash
打包并使用 xz压缩
[root@tianyun ~]#time tar -cJf etc.tar.xz /etc
```





比较：

```bash
[root@tianyun ~]# ls -lh etc*  
-rw-r--r--. 1 root root 11M Jun 24 11:09 etc.tar.bz2  
-rw-r--r--. 1 root root 12M Jun 24 11:07 etc.tar.gz  
-rw-r--r--. 1 root root 8.3M Jun 24 11:10 etc.tar.xz
```

扩展

- ==-a:自动选择压缩方式==
- 语法：==tar -caf 指定的路径/文件 要打包的东西==

```ini
[root@tianyun ~]# tar -caf etc.tar.bz2 /etc # -a 根据文件的后缀自动匹配压缩  
[root@tianyun ~]# tar -caf etc.tar.xz /etc  
[root@tianyun ~]# tar -caf etc.tar.gz /etc  
[root@tianyun ~]# file etc*  
etc.tar.bz2: bzip2 compressed data, block size = 900k  
etc.tar.gz: gzip compressed data, from Unix, last modified: Tue Jun 24 11:20:37  
2025  
etc.tar.xz: xZ compressed data  

[root@tianyun ~]# tar --help |grep '\-a'
```

##### 一解包解压  

- ==-xf 解压==
- ==-C  文件路径  解压到指定目录==
  - 语法：==tar -xf 指定的路径/文件  -C 路径==

```bash
[root@tianyun ~]# tar -xf etc.tar.gz  
[root@tianyun ~]# tar -xf etc.tar.xz    # 解压到当前目录
[root@tianyun ~]# tar xf etc.tar.bz2 -C /var/tmp/   # 解压到指定目录
如果只是解包：  
[root@tianyun ~]# tar -cf etc.tar /etc  
[root@tianyun ~]# tar -xf etc.tar
```

### 六、文件查找与定位

#### 16. `find` - 在目录树中查找文件
**功能**：功能极其强大，可以根据名称、大小、修改时间、类型等条件进行搜索。
**基本语法**：`find <路径> <选项> <操作>`

**案例**：

```bash
# 在当前目录及其子目录下查找名为 file1.txt 的文件
sudo find . -name "file1.txt"

# 在/目录及其子目录下查找名为 passwd 的文件
sudo find / -name "passwd"

# 在/etc目录及其子目录下查找名为 passwd 的文件
sudo find /etc -name "passwd"

# 在 /var 目录下查找所有 .log 文件（不区分大小写）
sudo find /var -iname "*.log"

# 查找/etc目录下大于 10MB 的文件
sudo find /etc -size +10M

# 查找 /var/log 目录下 7 天内修改过的文件(其中m代表modify)
$ find /var/log -mtime -7

# 查找 /var/log 目录下 7 天前修改过的文件(其中m代表modify)
$ find /var/log -mtime +7

# 查找当前目录下的所有目录
sudo find . -type d

# 查找并删除当前目录下所有 etc* 文件（谨慎使用！）
sudo find . -name "etc*" -exec  rm -rf {}   \;

-exec \;  固定的语法格式
{}		  前面找到的内容

#查找并删除当前目录下所有 .tmp 文件 (A 谨慎使用!)
$ find . -name "*.tmp" -delete

待以下知识点学完后，再回来细看find:
1. 文件权限
2. 输入输出重定向
```

### 17. locate - 在数据库中查找文件

功能：基于数据库（updatedb）快速查找文件，速度比 find 快很多，但无法查找新创建的文件（需要先更新数据库）。

案例：==**yum install -y mlocate(要提前下载)**==

```bash
#下载
yum install -y mlocate

#如果查不到，可能是有限制，将如下文件的prunepath下的路径进行删除
vim /etc/updatedb.conf

# 查找所有名为passwd的文件
$ locate passwd

# 更新 locate 数据库(需要 root 权限)
$ sudo updatedb
```

---

### 七、查看命令和文件的类型

#### 18. `type` - 揭示命令的真实身份

`type` 命令的核心作用就是告诉我们，输入的命令**究竟属于以上哪一种类型**，并显示其具体定义或路径。

当在 Shell 中输入一个命令时，它可能是多种东西：
*   **一个外部可执行程序** (如 `/bin/ls`)
*   **一个 Shell 内置命令** (如 `cd`, `echo`)
*   **一个命令别名** (Alias，如 `ll` 通常是 `ls -l` 的别名)
*   **一个 Shell 函数** (Function)
*   **一个关键字** (Keyword，如 `if`, `for`)

```bash
[root@tianyun ~]# type cd
cd is a shell builtin
[root@tianyun ~]# type -a cd			# -a查看所有的cd命令
cd is a shell builtin					# shell内置命令
cd is /bin/cd							# 外部的可执行程序
cd is /usr/bin/cd

[root@tianyun ~]# type -a date
date is /bin/date						# 外部的可执行程序
date is /usr/bin/date

[root@tianyun ~]# type -a ll
ll is aliased to `ls -l --color=auto'	# alias别名命令

[root@tianyun ~]# type -a if
if is a shell keyword
[root@tianyun ~]# type -a for
for is a shell keyword


别名alias扩展：
- 查看当前已有的alias
[root@tianyun ~]# alias 
alias cp='cp -i'
alias egrep='egrep --color=auto'
alias fgrep='fgrep --color=auto'
alias grep='grep --color=auto'
alias l.='ls -d .* --color=auto'
alias ll='ls -l --color=auto'
alias ls='ls --color=auto'
alias mv='mv -i'
alias rm='rm -i'

- 创建新的别名alias【临时】
[root@tianyun ~]# alias yangge='ls /etc/sysconfig/network-scripts/'
```

#### 19. `file` - 揭示文件的真实类型

`file` 命令是 Linux 中用于**查看文件类型**的必备工具。它的核心作用是告诉你一个文件的**真实类型**，而不是依赖容易伪造的文件扩展名（如 `.txt`, `.exe`, `.jpg`）

```bash
[root@tianyun ~]# file /etc  
/etc: `directory`  
# 目录  
[root@tianyun ~]# file /etc/hosts

/etc/hosts:ASCII`text`  
#文本文件  
[root@tianyun ~]# file /etc/sysconfig/selinux  
/etc/sysconfig/selinux: symbolic link to `../selenux/config' #链接文件  
[root@tianyun ~]# file /usr/bin/ls  
#可执行文件  
/usr/bin/ls:ELF 64-bit LSB `executable`, x86-64, version 1 (SYSV), dynamically linked (uses shared repos), for GNU/Linux 2.6.32, BuildID[sha1]=c8ada1f7095f6b2bb7ddc848e088c2d615c3743e, stripped  
[root@tianyun ~]# file /dev/sda  
/dev/sda:'block special'  
#块设备文件  
[root@tianyun ~]# file /dev/pts/1  
#字符设备文件  
/dev/pts/1:'character special'  
[root@tianyun ~]# file /usr/share/backgrounds/morning.jpg  
/usr/share/backgrounds/morning.jpg:'JPEG image data', JFIF standard 1.01  
#图像文件  
[root@tianyun ~]# file /usr/share/info/tar.info-1.gz  
/usr/share/info/tar.info-1.gz:'gzip compressed data', from Unix, max compression #gzip压缩文件  
[root@tianyun ~]# file /usr/share/doc/rpm-4.11.3/ChangeLog.bz2  
/usr/share/doc/rpm-4.11.3/ChangeLog.bz2:'gzip2 compressed data', block size = 900k  
#gzip2压缩文件  
[root@tianyun ~]# file /usr/lib/modules/3.10.0-1160.el7.x86_64/kernel/fs/ext4/ext4.ko.xz  
/usr/lib/modules/3.10.0-1160.el7.x86_64/kernel/fs/ext4/ext4.ko.xz:'xz compressed data'  
#xz压缩文件  
[root@tianyun ~]# file /usr/local/aegis/AlisecCheck/pylibs/thirdParty.zip  
/usr/local/aegis/AlisecCheck/pylibs/thirdParty.zip:'zip archive data', at least v1.0 to extract  
#zip归档文件
```

l**rz****sz**命令(需要提前安装)

1.rz

Windows文件->Linux文件

2.sz

Linux文件->文件Windows

## Linux 用户及用户组管理

---

### 一、 核心概念简介

1. **用户 (User)**

   *   系统资源的直接使用者。每个用户都有一个唯一的 `UID` (User ID)。
   *   类型：
       *   **超级用户 (root)**: UID 为 0，拥有系统最高权限。
       *   **系统用户**: UID 为 1-999，通常用于运行系统服务或后台进程，不允许登录。
       *   **普通用户**: UID 从 1000 开始，供实际使用系统的人使用。

2. **用户组 (Group)**

   *   用户的集合。其主要目的是为了**共享资源的权限分配**。给一个组授权，就意味着给组内所有成员授权。
   *   每个组都有一个唯一的 `GID` (Group ID)。
   *   每个用户都有一个**主组 (Primary Group)** 和可以属于零个或多个**附加组 (Supplementary Group)**。
       *   用户（alice）创建时，系统会默认为用户alice创建同名的组（alice），作为用户的主组。
       *   附加组用于获取额外的权限。

3. **配置文件**

   * `/etc/group`: 存储组信息

     *   格式：`组名:组密码占位符(x):GID:组内成员列表(以逗号分隔)`

   * `/etc/passwd`: 存储用户信息

     *   格式：`用户名:密码占位符(x):UID:主组的GID:用户描述:家目录:默认Shell`

   * `/etc/shadow`: 存储用户密码信息

     *   格式：`用户名:加密的密码:::::::`

     ```bash
     [root@tianyun ~]# head -n1 /etc/passwd
     root:x:0:0:root:/root:/bin/bash
     
     [root@tianyun ~]# head -n1 /etc/shadow
     root:$6$qcDZiX2fWW4ke82A$qMnUhegCa4JQOFgwg1MskYGdX9hMTtCCuHVoVJZ1SaMCAVEma7i45LpbdU0NOITvRi9xIS586J0H0sdX/u3rB.::0:99999:7:::
     
     [root@tianyun ~]# head -n1 /etc/group
     root:x:0:
     ```

---

### 二、 组管理 

我们以创建开发部门 (`DEV`)、测试部门 (`QA`)、运维部门 (`OPS`)、IT部门 (`IT`) 、人力资源部（`HR`）为例。

#### 1. `groupadd` - 创建组

```bash
- 创建 DEV AQ OPS IT 四个用户组
[root@tianyun ~]# groupadd DEV
[root@tianyun ~]# groupadd QA
[root@tianyun ~]# groupadd OPS
[root@tianyun ~]# groupadd IT

- 创建组 HR 时指定 GID (可选)
[root@tianyun ~]# groupadd HR -g 2001

[root@tianyun ~]# tail -n5 /etc/group
DEV:x:1001:
QA:x:1002:
OPS:x:1003:
IT:x:1004:
HR:x:2001:
[root@bogon ~]# groupadd  -r djn 
```

**常用选项：**

*   `-g GID`: 指定新组的 GID(大于等于1000)。
*   `-r`: 创建一个系统组（GID 在 1-999 之间）。

#### 2. `groupmod` - 修改组属性

```bash
- 将组名 HR 修改为 HRRR
[root@tianyun ~]# groupmod HR -n HRRR

- 将 HRRR 组的 GID 修改为 3000
[root@tianyun ~]# groupmod HRRR -g 3000
```

**常用选项：**

*   `-n 新组名`: 修改组名。
*   `-g 新GID`: 修改组的 GID。

#### 3. `groupdel` - 删除组

```bash
- 删除 HRRR 组
[root@tianyun ~]# groupdel HRRR
```

---

### 三、 用户管理

我们以创建用户 `yangge520`, `tianyun`, `alice`, `zhuzhuxia` 为例。

#### 1. `useradd` - 创建用户

```bash
- 创建用户 tianyun
[root@tianyun ~]# useradd tianyun -g
注意：单纯使用 `useradd 用户名` 会创建一个与用户名同名的 `主组`

[root@tianyun ~]# grep 'tianyun' /etc/passwd /etc/shadow /etc/group
/etc/passwd:tianyun:x:1001:`2002`::/home/tianyun:/bin/bash
/etc/shadow:tianyun:$6$f8o8ks8G$3Gef8KujvUz3/aInobb.mW/I0:20342:0:99999:7:::
/etc/group:tianyun:x:`2002`:

- 查看用户tianyun的信息 
[root@tianyun ~]# id tianyun
uid=1001(tianyun) gid=2002(tianyun) groups=2002(tianyun)
    tianyun:UID	    tianyun:主组	   tianyun:所有组（包括主组）
    

- 创建用户 yangge，附加组为 OPS 和 IT
[root@tianyun ~]# useradd yangge520 -G OPS,IT 
[root@tianyun ~]# id yangge520
uid=1002(yangge520) gid=1006(yangge520) groups=1006(yangge520),1003(OPS),1004(IT)

- 创建用户 alice，附加组为 QA，并指定其家目录为 (/opt/alice)
[root@tianyun ~]# useradd alice -d /opt/alice -G QA 

- 创建用户 zhuzhuxia，附加组为 IT，并指定其 UID 为 2000
[root@tianyun ~]# useradd zhuzhuxia -u 2000 -G IT 

注：不要修改用户的主组，用户创建时默认会创建一个同名的组作为主组（默认）
-G 创建用户时，指定用户的附加组
-g 创建用户时，指定用户的主组（不建议使用）
-d 创建用户时，指定用户的 HOME（默认为/home/username）
-u 创建用户时，指定用户的 UID
```

**Ubuntu创建用户区别：**

```bash
sudo useradd -m -s /bin/bash alice
```

- `-m` (`--create-home`)：创建用户的家目录
- `-s /bin/bash` (`--shell`)：指定用户的登录 shell

#### 2. `passwd` - 修改用户密码

```bash
- root为普通用户 yangge 设置密码
[root@tianyun ~]# passwd alice
Changing password for user alice.
New password: 
BAD PASSWORD: The password is a palindrome
Retype new password: 
passwd: all authentication tokens updated successfully.

- 普通用户 alice 自己修改密码
[alice@tianyun ~]$ passwd (密码是wd20140802)
Changing password for user alice.
Changing password for alice.
(current) UNIX password: 										# 提供旧密码（当前）
New password: 
BAD PASSWORD: The password is too similar to the old one		# 新密码达到复杂性要求
New password: 
BAD PASSWORD: The password is shorter than 8 characters
New password: 
Retype new password: 
passwd: all authentication tokens updated successfully.
```

#### 3. `usermod` - 修改用户属性

```bash
- 将用户 zhuzhuxia 添加到 QA 组作为附加组,append:附加
[root@tianyun ~]# usermod zhuzhuxia -aG QA

- 修改用户 yangge520 的登录名为 xiaoyang,-l:login_name
[root@tianyun ~]# usermod yangge520 -l xiaoyang

- 锁定用户 tianyun 的账户，禁止其登录,-L:lock
[root@tianyun ~]# usermod -L tianyun

- 解锁用户 tianyun 的账户
[root@tianyun ~]# usermod -U tianyun

- 设置用户 tianyun 账户的过期时间 ,-e expiredate 过期日期
[root@tianyun ~]# usermod -e "2025-11-10" tianyun

- 查看用户 tianyun 账户的过期时间（change age）
[root@bogon ~]# chage -l tianyun     chage全拼是change age，-l是list
最近一次密码修改时间					：12月 26, 2025
密码过期时间					：从不
密码失效时间					：从不
帐户过期时间						：从不
两次改变密码之间相距的最小天数		：0
两次改变密码之间相距的最大天数		：99999
在密码过期之前警告的天数	：7
- 取消用户 tianyun 账户的过期时间
[root@tianyun ~]# usermod -e "" tianyun
```

#### 4. `userdel` - 删除用户

```bash
- 删除用户 zhuzhuxia，但保留其家目录
[root@tianyun ~]# userdel zhuzhuxia

- 删除用户 alice，同时删除其家目录和邮件池
[root@tianyun ~]# userdel -r alice 
```

**常用选项：**

*   `-r`: 删除用户的同时，一并删除其家目录（/home/下面）和邮件池 (`/var/mail/下面)。

#### 5. `su` - 切换用户

```bash
- 从root用户切换到普通用户 tianyun【不需要提供密码】
[root@tianyun ~]# su - tianyun
[root@tianyun ~]# exit

- 从普通用户切换到其它用户，如root【需提供切换用户密码】
[alice@tianyun ~]$ su - root

- 扩展：Ubuntu 从普通（yangge）用户切换到root
yangge@server01:~$ sudo su - root
[sudo] password for yangge: 
root@server01:~# 
```

---

### 四、 组成员管理

#### 1. `gpasswd`  - 组成员管理

`gpasswd` 是专门用来管理组的管理员和成员的命令。

```bash
- 将用户 tianyun 添加到 DEV 组中(附加组)
[root@tianyun ~]# gpasswd -a tianyun DEV

- 将用户 xiaoyang 从 OPS 组中移除，-d:delete
[root@tianyun ~]# gpasswd -d xiaoyang OPS
```

---

### 五、 查看用户及组信息

#### 1. `id` - 查看用户信息

```bash
- 查看当前用户的信息
[root@tianyun ~]# id

- 查看指定用户 tianyun 的信息 
[root@tianyun ~]# id tianyun
```

#### 2. `groups` - 查看用户所属组

```bash
- 查看当前用户所属的所有组
[root@tianyun ~]# groups

- 查看指定用户 yangge 所属的所有组
[root@tianyun ~]# groups  yangge
```

#### 3. `getent` - **查看组中的成员**

```bash
- 查看 DEV 组中的成员
[root@tianyun ~]# getent group DEV
DEV:x:1001:
[root@tianyun ~]# getent group OPS
OPS:x:1003:xiaoyang,tianyun	
```

---

### 六、练习—实战示例

假设我们要实现以下组织结构：

*   `yangge`：同时属于组`DEV`  `OPS`  `IT`
*   `tianyun`：同时属于组 `OPS` `IT`
*   `alice`：同时属于组 `QA` `IT`
*   `zhuzhuxia`：同时属于组 `IT`

**操作步骤：**

```bash
1. 创建组
# groupadd DEV
# groupadd QA
# groupadd OPS
# groupadd IT

2. 创建用户，并指定附加组
# useradd -G IT,DEV,OPS yangge
# useradd -G IT,OPS tianyun
# useradd -G IT,QA alice
# useradd -G IT zhuzhuxia

3. 为所有用户设置密码
# passwd yangge
# passwd tianyun
# passwd alice
# passwd zhuzhuxia

4. 将 zhuzhuxia 加入到 DEV 组（作为附加组）
# gpasswd -a zhuzhuxia DEV

5. 验证
# groups yangge      # 应显示：yangge : IT DEV OPS 
# groups zhuzhuxia   # 应显示：zhuzhuxia : IT DEV
# groups tianyun	 # 应显示：zhuzhuxia : IT OPS
# id alice

# getent group IT	 # 查看组中的成员
# getent group DEV
# getent group OPS
# getent group QA

6. 将 yangge 调离运维部 OPS
# gpasswd -d yangge OPS
```



## Linux文件权限管理

```bash
[root@yangge ~]# ls -l file1.txt 
-rw-r----- 1 root DEV  4096  Sep  9 19:29 file1.txt
```

### 一、核心概念

#### 1. 用户和用户组

* **用户 (User)**：系统资源的直接使用者。每个文件都有一个所有者，称为 **属主 (Owner)**。

* **用户组 (Group)**：用户的集合。每个文件都属于一个特定的组，称为 **属组 (Group)**。组用于简化对多个用户的权限分配。

* **其他人 (Others)**：不属于文件属主，也不在文件属组中的任何其他用户。

  | 用户类型         | 定义                               | 说明                                                         |
  | ---------------- | ---------------------------------- | ------------------------------------------------------------ |
  | 属主（Owner）    | 文件 / 目录的创建者或当前所有者    | 对文件拥有最高控制权，默认创建者为属主                       |
  | 属组（Group）    | 文件 / 目录所属的用户组            | 用于批量管理权限（比如给 “开发组” 统一分配权限，避免逐个设置用户） |
  | 其他人（Others） | 既不是属主，也不属于属组的所有用户 | 系统中除上述两类外的所有用户，通常权限最严格                 |

  举个例子：文档中`file1.txt`的信息 `-rw-r----- 1 root DEV 4096 Sep 9 19:29 file1.txt`，这里 “属主是`root`，属组是`DEV`，其他人是除`root`和`DEV`组用户外的所有用户”。

#### 2. 权限类型 

权限作用于三类实体：**属主 (u)**、**属组 (g)**、**其他人 (o)**

权限分为 “读（r）、写（w）、执行（x）”，但对**文件**和**目录**的含义完全不同，这是容易混淆的点，必须区分清楚。

| 权限符号   | 数字表示 | 对文件的含义               | 对目录的含义                      |
| :--------- | :------- | :------------------------- | :-------------------------------- |
| `r` (读)   | 4        | 可读取文件内容             | 可列出目录中的内容 (如 `ls` 命令) |
| `w` (写)   | 2        | 可修改文件内容             | 可在目录中创建、删除、重命名文件  |
| `x` (执行) | 1        | 可执行该文件（程序或脚本） | 可进入该目录 (如 `cd` 命令)       |

- 对目录而言，“w 权限” 风险极高：只要有目录的 w 权限，即使没有文件的 w 权限，也能删除该目录下的文件（因为删除操作是对目录的修改，不是对文件的修改）。
- 对文件而言，“x 权限” 需谨慎：仅给可执行程序（如`bash`脚本、`C语言编译后的二进制文件`）设置 x 权限，普通文本文件（如`.txt`、`.cfg`）不需要 x 权限，否则可能有安全风险。

#### 3. 权限表示法

*   **字符表示法**：`rwxr-xr--`
    *   前三位 `rwx`：属主权限
    *   中三位 `r-x`：属组权限
    *   后三位 `r--`：其他人权限
    *   `-` 表示没有对应权限。
*   **数字（八进制）表示法**：`754`
    *   将每组 `rwx` 看成二进制（有权限为1，无则为0），再转换为十进制。
    *   `rwx` = `111` = 7
    *   `r-x` = `101` = 5
    *   `r--` = `100` = 4
    *   因此 `rwxr-xr--` = `754`

---

### 二、基本命令详解

#### 1. `chown`- 修改文件属主和属组

* **命令**：`chown` (change owner)   

* chown  属主:属组 文件名/目录名

* -R 递归修改

  ```bash
  [root@tianyun ~]# touch file1.txt
  [root@tianyun ~]# mkdir dir1
  [root@tianyun ~]# touch dir1/file{1..10}
  
  [root@yangge ~]# chown yangge file1.txt 				# 仅修改属主为 yangge
  [root@yangge ~]# chown :DEV file1.txt 					# : 前为空，表示 “属主不修改”，只修改属组为 DEV。
  [root@yangge ~]# chown zhuzhuxia:IT file1.txt		 	# 同时修改属主为 zhuzhuxia，属组为 IT
  [root@yangge ~]# chown -R alice:QA dir1					# 递归修改 dir1 目录下所有内容的属主和属组
  ```

#### 2. `chgrp`-  修改文件属组（只能改属组）

- **命令**：`chgrp` (Change Group)

  ```bash
  [root@yangge ~]# chgrp IT file1.txt 					# 仅修改属组为 DEV
  ```

#### 3. `chmod` - 修改文件权限

**A. 字符模式**

* **操作对象**：`u`(属主), `g`(属组), `o`(其他人), `a`(所有人)

* **操作符**：`+`(添加), `-`(移除), `=`(精确设置)

* **权限**：`r`, `w`, `x`

  ```bash
  [root@yangge ~]# chmod u+x file1.txt 					# 给属主添加执行权限
  [root@yangge ~]# chmod g-w file1.txt 					# 从属组移除写权限
  [root@yangge ~]# chmod o=r-- file1.txt 					# 为其他人设置权限为只读
  [root@yangge ~]# chmod a=rwx file1.txt 					# 为所有人设置权限为读、写、执行
  [root@yangge ~]# chmod ug=rw,o=r file1.txt				# 为属主属组设置权限读写，其他人读
  ```

**B. 数字模式**

* 直接使用三位八进制数字设置权限

  ```bash
  [root@yangge ~]# chmod 755 file1.txt 					# u=rwx (7), g=rx (5), o=rx (5)
  [root@yangge ~]# chmod 644 file1.txt 					# u=rw- (6), g=r-- (4), o=r-- (4)
  [root@yangge ~]# chmod 770 file1.txt 					# u=rwx (7), g=rwx (7), o=--- (0)
  [root@yangge ~]# chmod 600 file1.txt 					# u=rw- (6), g=--- (0), o=--- (0)
  ```

---

### 三、案例实战

**前提准备：创建用户和组**
在进行以下实战前，请先确保用户和组已创建并分配好。

```bash
# 创建用户组
groupadd DEV
groupadd QA
groupadd OPS
groupadd IT

# 创建用户并设置主要组，同时添加到附加组
useradd -g DEV -G OPS yangge 								# 附加组OPS
useradd -G OPS tianyun       								# 附加组OPS
useradd -G QA alice          								# 附加组QA
useradd -G IT zhuzhuxia      								# 附加组IT

# 为用户设置密码
echo "000000" | passwd --stdin yangge
echo "000000" | passwd --stdin tianyun
echo "000000" | passwd --stdin alice
echo "000000" | passwd --stdin zhuzhuxia
```

---

#### 实战案例 1：项目目录权限设置

**需求**：创建项目目录 `/opt/projet`

*   **属主**：`yangge` (所有者)
*   **属组**：`DEV` (开发部)
*   **权限**：`DEV` 组成员可读、写、执行；其他人没有权限

**步骤**：

1. **创建目录并修改属主属组**

   ```bash
   mkdir -p /opt/project
   chown yangge:DEV /opt/project -修改目录的属主为yangge，属组为DEV（用chown一次性设置）
   ```

2. **设置基础权限**：给 `DEV` 组完整权限，并禁止其他人访问。

   ```bash
   chmod 770 /opt/project 						# u=rwx (7), g=rwx (7), o=--- (0)
   ```

3. **验证权限**

   ```bash
   ls -ld /opt/project
   
   - `DEV` 组成员可以自由创建、删除文件
   - `其他用户` 无法访问
   ```

---

#### 实战案例 2：敏感配置文件保护

**需求**：系统配置文件 `/etc/test.cfg` 包含密码信息。

*   **属主**：`root`
*   **属组**：`IT`
*   **权限**：只有 `root` 可以**读写**；`IT` 组成员只能**读取**；其他任何人**不能访问**。

**步骤**：

1. **修改属主和属组**

   ```bash
   chown root:IT /etc/test.cfg
   ```

2. **修改权限**

   *   **分析**：
       *   属主 `root` 需要 `rw-` (6)：读、写。
       *   属组 `IT` 需要 `r--` (4)：只读。
       *   其他人需要 `---` (0)：无权限。
   *   **设置 (数字方式)**：

   ```bash
   sudo chmod 640 /etc/test.cfg
   # u=rw- (6), g=r-- (4), o=--- (0)
   ```

   *   **字符方式实现**：

   ```bash
   sudo chmod u=rw,g=r,o= /etc/test.cfg
   ```

---

## Linux chattr

### 一、chattr命令概述

`chattr`（Change Attributes）是Linux系统中用于修改文件或目录的扩展属性的强大工具，这些属性比常规权限(rwx)`更底层`，能够提供额外的文件保护和控制机制。

### 二、常用属性标志

| 属性 | 说明                                        | 适用场景         |
| ---- | ------------------------------------------- | ---------------- |
| a    | Append Only,仅追加（不可删除/修改已有内容） | 日志文件保护     |
| i    | immutable,不可修改（永恒的，不可改变的）    | 系统关键文件保护 |
| A    | No Access Time Update,不更新访问时间atime   | 减少磁盘I/O      |
| c    | Compressed,压缩存储                         | 节省磁盘空间     |

### 三、使用基础案例

#### 案例1：保护系统关键文件（不可修改）

```bash
[root@yangge ~]# touch file100.txt
[root@yangge ~]# lsattr file100.txt   # 查看文件的属性 lsattr：list attribute  
---------------- file100.txt

[root@yangge ~]# chattr +i file100.txt 				# 增加i属性
[root@yangge ~]# lsattr file100.txt 
----i----------- file100.txt

测试修改：
[root@yangge ~]# echo "111" > file100.txt 			# 修改失败
-bash: file100.txt: Permission denied

测试删除：
[root@yangge ~]# rm -rf file100.txt 				# 删除失败
rm: cannot remove ‘file100.txt’: Operation not permitted

[root@yangge ~]# chattr -i file100.txt				# 解除保护


实际应用：
[root@yangge ~]# chattr +i /etc/passwd /etc/shadow

[root@yangge ~]# useradd zhuzhuxia					# 创建用户失败，因为不能写相应的文件
useradd: cannot open /etc/passwd
```

#### 案例2：日志文件保护（仅追加）

```bash
[root@yangge ~]# touch file200.txt
[root@yangge ~]# chattr +a file200.txt 				# 设置a属性，表示内容可以追加
[root@yangge ~]# lsattr file200.txt 
-----a---------- file200.txt

测试修改：
[root@yangge ~]# echo "222" > file200.txt 			# 修改（以覆盖的方式）
-bash: file200.txt: Operation not permitted

测试追加：									
[root@yangge ~]# echo "222" >> file200.txt 			# 追加成功
[root@yangge ~]# echo "333" >> file200.txt 
[root@yangge ~]# cat file200.txt 
222
333

测试删除：
[root@yangge ~]# rm -rf file200.txt 
rm: cannot remove ‘file200.txt’: Operation not permitted


实际应用：
[root@yangge ~]# chattr +a /var/log/secure

[root@yangge ~]# tailf /var/log/secure
Jul 21 10:57:35 yangge passwd:m: couldn't update the login keyring password: no old password was entered
Jul 21 10:57:48 yangge sshd[4593]: reverse mapping checking getaddrinfo for bogon [192.168.92.1] failed - POSSIBLE BREAK-IN ATTEMPT!
Jul 21 10:57:51 yangge sshd[4593]: Accepted password for hr01 from 192.168.92.1 port 64581 ssh2
Jul 21 10:57:51 yangge sshd[4593]: pam_unix(sshd:session): session opened for user hr01 by (uid=0)
Jul 21 10:58:23 yangge sshd[4687]: reverse mapping checking getaddrinfo for bogon [192.168.92.1] failed - POSSIBLE BREAK-IN ATTEMPT!
Jul 21 10:58:26 yangge sshd[4687]: Accepted password for alice from 192.168.92.1 port 64612 ssh2
Jul 21 10:58:26 yangge sshd[4687]: pam_unix(sshd:session): session opened for user alice by (uid=0)
Jul 21 14:50:22 yangge useradd[7818]: new group: name=user01, GID=1007
Jul 21 14:50:22 yangge useradd[7818]: new user: name=user01, UID=1005, GID=1007, home=/home/user01, shell=/bin/bash
Jul 21 16:18:30 yangge useradd[8996]: failed adding user 'zhuzhuxia', exit code: 1


以下为新产生的日志:

Jul 21 16:27:44 yangge gdm-password]: gkr-pam: unlocked login keyring
Jul 21 16:27:51 yangge gdm-password]: pam_unix(gdm-password:session): session closed for user tianyun
```

#### 案例3：减少磁盘I/O（禁用atime更新）

```bash
[root@dongjianing ~]# mkdir djn12
[root@dongjianing ~]# chattr +A  -R djn12
[root@dongjianing ~]# stat djn12
  文件："djn12"
  大小：6         	块：0          IO 块：4096   目录
设备：fd00h/64768d	Inode：50965810    硬链接：2
权限：(0755/drwxr-xr-x)  Uid：(    0/    root)   Gid：(    0/    root)
环境：unconfined_u:object_r:admin_home_t:s0
最近访问：2026-01-08 15:28:31.066322138 +0800#此处访问时间不变
最近更改：2026-01-08 15:28:31.066322138 +0800
最近改动：2026-01-08 15:29:10.676323256 +0800
创建时间：-
[root@dongjianing ~]# cd djn12
[root@dongjianing djn12]# touch 111
[root@dongjianing djn12]# cd
[root@dongjianing ~]# stat djn12
  文件："djn12"
  大小：17        	块：0          IO 块：4096   目录
设备：fd00h/64768d	Inode：50965810    硬链接：2
权限：(0755/drwxr-xr-x)  Uid：(    0/    root)   Gid：(    0/    root)
环境：unconfined_u:object_r:admin_home_t:s0
最近访问：2026-01-08 15:28:31.066322138 +0800#此处访问时间不变
最近更改：2026-01-08 15:29:32.590323875 +0800
最近改动：2026-01-08 15:29:32.590323875 +0800
创建时间：-
```

## CentOS 软件包管理DNF/YUM

---

Linux 系统的功能实现、服务搭建（如 Web 服务器、数据库）及工具扩展，均依赖大量相互关联的软件包，而手动处理软件安装、依赖解决、版本更新等操作，不仅效率低下，还易出现 “依赖地狱”“版本冲突”“来源不可靠” 等问题。

为解决这一痛点，YUM（Yellowdog Updater Modified）作为 RPM 包管理器的前端工具应运而生，它能自动分析软件依赖关系、从指定仓库（Repo）获取可靠软件包，实现一键安装、升级、卸载等操作。DNF（Dandified YUM）则是 YUM 的升级版本，优化了性能与依赖解析逻辑，逐步成为新一代 Linux 系统的默认包管理工具。

在实际使用中，默认官方软件仓库常存在下载速度慢、部分软件包缺失等问题，因此配置阿里云等国内可信镜像源成为主流选择，既能提升软件获取效率，又能保障软件包的安全性与稳定性。YUM/DNF 及其镜像源配置相关技能，也成为 Linux 运维、开发、测试等岗位必备的基础能力，广泛支撑各类技术场景的落地。

### **一、配置阿里云 YUM 源**

#### **1. 删除原有 YUM 源**

```bash
[root@yangge ~]# rm -rf /etc/yum.repos.d/*

[root@yangge ~]# yum repolist
Loaded plugins: fastestmirror, langpacks
Determining fastest mirrors
repolist: 0										# 当前没有任何YUM源（仓库），软件包的数量为0
```

#### **2. 配置阿里云基本源**

```bash
[root@yangge ~]# curl https://mirrors.aliyun.com/repo/Centos-7.repo -o /etc/yum.repos.d/CentOS-Base.repo 
[root@yangge ~]# ls /etc/yum.repos.d/
CentOS-Base.repo

-o 将下载文件输出到指定文件
```

#### **3. 清理并重建 YUM 缓存**

```bash
yum clean all     # 清理系统中缓存的旧YUM仓库数据（包括元数据和软件包缓存）【可选操作】
yum makecache     # 根据当前YUM源重新生成缓存，加速后续软件包查询和安装【可选操作】
```

#### **4. 验证是否生效**

```bash
[root@yangge ~]# yum repolist  # 查看当前所有可用的YUM源
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile  # 从缓存中加载镜像速度信息
 * base: mirrors.aliyun.com  # 基础仓库使用阿里云镜像
 * extras: mirrors.aliyun.com  # 额外仓库使用阿里云镜像
 * updates: mirrors.aliyun.com  # 更新仓库使用阿里云镜像
repo id                           repo name                                                status
base/7/x86_64                     CentOS-7 - Base - mirrors.aliyun.com                     10,072  # 基础仓库包含10072个软件包
extras/7/x86_64                   CentOS-7 - Extras - mirrors.aliyun.com                      526  # 额外仓库包含526个软件包
updates/7/x86_64                  CentOS-7 - Updates - mirrors.aliyun.com                   6,173  # 更新仓库包含6173个软件包
repolist: 16,771  # 总软件包数量：16771个（说明阿里云基础源配置成功）
```

这里可以执行一下sl

#### **5. 增加阿里云EPEL源**

```shell
[root@yangge ~]# curl https://mirrors.aliyun.com/repo/epel-7.repo -o /etc/yum.repos.d/epel.repo
# 命令解释：下载阿里云的EPEL（Extra Packages for Enterprise Linux）源配置文件
# EPEL源提供了许多CentOS官方源中没有的额外软件包

[root@yangge ~]# ls /etc/yum.repos.d/
CentOS-Base.repo  epel.repo  # 验证结果：已存在基础源和EPEL源配置文件

[root@yangge ~]# yum repolist
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
repo id                       repo name                                                    status
base/7/x86_64                 CentOS-7 - Base - mirrors.aliyun.com                         10,072
epel/x86_64                   Extra Packages for Enterprise Linux 7 - x86_64               13,791  # EPEL源包含13791个软件包
extras/7/x86_64               CentOS-7 - Extras - mirrors.aliyun.com                          526
updates/7/x86_64              CentOS-7 - Updates - mirrors.aliyun.com                       6,173
repolist: 30,562  # 总软件包数量增加到30562个（说明EPEL源配置成功）
```

### **二、实战安装示例**

#### **1. 安装常用工具**

```bash
[root@yangge ~]# yum -y install sl
[root@yangge ~]# sl

[root@yangge ~]# yum -y install wget curl vim-enhanced git net-tools bash-completion
- vim-enhanced: vi的增强版vim
- bash-completion: bash shell提供一些额外的补全

使用方法详解：
[root@yangge ~]# rpm -qa |grep vim-en
vim-enhanced-7.4.629-8.el7_9.x86_64
- rpm -qa 只列出已安装的软件包

[root@yangge ~]# yum list |grep vim-en
vim-enhanced.x86_64                      2:7.4.629-8.el7_9             @updates 
- yum list: 列出所有的YUM仓库软件包，包括已经安装的和未安装
- grep vim-en: 从所有的软件包中过滤，名字带有vim-en的包

[root@yangge ~]# yum list |grep bash-com
bash-completion.noarch                   1:2.1-8.el7                   @anaconda
bash-completion-extras.noarch            1:2.1-11.el7                  epel     
cekit-bash-completion.noarch             4.12.0-1.el7                  epel     
coccinelle-bash-completion.noarch        1.0.7-4.el7                   epel     
drbd-bash-completion.x86_64              9.17.0-1.el7                  epel     
libguestfs-bash-completion.noarch        1:1.40.2-10.el7               base     
libvirt-bash-completion.x86_64           4.5.0-36.el7_9.5              updates  
python-django-bash-completion.noarch     1.11.27-1.el7                 epel     
python-django16-bash-completion.noarch   1.6.11.7-5.el7                epel 

# 思考I 查询已安装和所有可用的vsftpd软件包
[root@yangge ~]# yum list installed |grep vsftpd
[root@yangge ~]# yum list |grep vsftpd
vsftpd.x86_64                            3.0.2-29.el7_9                updates  
vsftpd-sysvinit.x86_64    

yum list 查看所有软件包，包括已安装和未安装（软件包仓库中）
yum list installed 只查询已安装的所有软件包，相当于rpm -qa

# 思考II 精确查询vsftpd软件包状态
[root@yangge ~]# yum list vsftpd
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
Available Packages # 可用包（未安装）
vsftpd.x86_64                               3.0.2-29.el7_9                                updates 

[root@yangge ~]# yum list installed vsftpd
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
Error: No matching Packages to list
# yum list 软件包名 查看该软件包的可用状态；yum list installed 软件包名 相当于rpm -q 软件包名（查询是否已安装）
```

#### **2. 安装 Apache（Web 服务器）**

```bash
[root@yangge ~]# yum -y install httpd
# 命令解释：安装Apache web服务器（软件包名为httpd）

[root@yangge ~]# systemctl start httpd  # 启动httpd服务
[root@yangge ~]# systemctl enable httpd  # 设置httpd服务开机自启动

[root@yangge ~]# systemctl stop firewalld.service  # 停止防火墙服务（临时关闭）
[root@yangge ~]# systemctl disable firewalld.service  # 禁止防火墙服务开机自启动（永久关闭）
# 说明：关闭防火墙是为了让外部能访问Apache服务（生产环境中更安全的做法是配置防火墙规则开放80端口）
```

Apache（全称 Apache HTTP Server）是一款**开源的 Web 服务器软件**，主要功能是：

- 接收客户端（如浏览器）的 HTTP 请求（如访问网页、提交表单）；
- 处理请求并返回对应的网页文件（如 HTML、图片、CSS 等）；
- 支持静态网页展示、动态网页解析（配合 PHP 等语言）、虚拟主机（一台服务器部署多个网站）等功能。
- 访问 `http://<你的服务器IP>` 测试是否成功。

#### **3. 卸载软件包**

```bash
# 卸载 vsftpd 示例
[root@yangge ~]# yum -y install vsftpd  # 先安装vsftpd（FTP服务器软件）
[root@yangge ~]# yum -y remove vsftpd  # 卸载vsftpd（-y自动确认卸载）

# 卸载 httpd 示例
[root@yangge ~]# systemctl stop httpd.service  # 先停止httpd服务（卸载前建议停止服务）
[root@yangge ~]# yum -y remove httpd  # 卸载httpd软件包
```

#### **4. 查询某个文件属于哪个包**

**案例一：没有netstat命令**

```bash
[root@yangge ~]# yum -y remove net-tools  # 卸载net-tools包，模拟netstat命令缺失场景
[root@yangge ~]# netstat
bash: netstat: command not found...  # 提示命令未找到

# 解决步骤：
1. 先了解命令文件的一般存储位置
[root@yangge ~]# which useradd 
/usr/sbin/useradd  # useradd命令位于/usr/sbin/目录
[root@yangge ~]# which date 
/bin/date  # date命令位于/bin/目录
# 结论：系统命令通常存放在/bin/或/sbin/（及/usr下的对应子目录）

2. 查询netstat命令由哪个软件包提供
[root@yangge ~]# yum provides "*bin/netstat"  
# 命令解释：yum provides 用于查询哪个软件包提供了指定文件；*bin/netstat 表示匹配任意路径下bin目录中的netstat
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
net-tools-2.0-0.25.20131004git.el7.x86_64 : Basic networking tools  # 对应的软件包
Repo        : base  # 来自base仓库
Matched from:
Filename    : /bin/netstat  # 该包包含/bin/netstat文件

3. 安装对应的软件包
[root@yangge ~]# yum -y install net-tools  # 安装net-tools包
[root@yangge ~]# netstat  # 再次运行netstat命令，成功执行
```

**案例二：没有vim命令**

```bash
[root@yangge ~]# yum -y remove vim-enh*  # 卸载vim相关包，模拟vim命令缺失场景
[root@yangge ~]# vim file1
bash: vim: command not found...  # 提示命令未找到

1. 查询vim命令由哪个软件包提供
[root@yangge ~]# yum provides "*bin/vim"  # 查找提供vim命令的软件包
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
2:vim-enhanced-7.4.629-7.el7.x86_64 : A version of the VIM editor which includes recent enhancements
Repo        : base
Matched from:
Filename    : /usr/bin/vim  # 该包包含/usr/bin/vim文件

2. 安装软件包vim-enhanced
[root@yangge ~]# yum -y install vim-enhanced  # 安装vim-enhanced包
[root@yangge ~]# vim file1  # 再次运行vim命令，成功执行
```

**案例三：没有rz/sz**

```bash
[root@tianyun ~]# yum -y remove lrzsz  # 卸载lrzsz包，模拟rz命令缺失场景
[root@tianyun ~]# rz
bash: rz: command not found...  # 提示命令未找到

[root@tianyun ~]# yum provides *bin/rz  # 查找提供rz命令的软件包
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
lrzsz-0.12.20-36.el7.x86_64 : The lrz and lsz modem communications programs  # 对应的软件包
Repo        : base
Matched from:
Filename    : /usr/bin/rz  # 该包包含/usr/bin/rz文件

[root@tianyun ~]# yum -y install lrzsz  # 安装lrzsz包（提供rz和sz文件传输命令）
```

**案例四：没有 vsftpd.conf 文件**

```bash
[root@yangge ~]# ls /etc/vsftpd/vsftpd.conf
ls: cannot access /etc/vsftpd/vsftpd.conf: No such file or directory  # 提示文件不存在

[root@yangge ~]# yum provides "*/vsftpd.conf"  # 查找提供vsftpd.conf文件的软件包（*匹配任意路径）
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
fail2ban-server-0.11.2-3.el7.noarch : Core server component for Fail2Ban
Repo        : epel
Matched from:
Filename    : /etc/fail2ban/filter.d/vsftpd.conf  # 非目标文件（属于fail2ban）

vsftpd-3.0.2-28.el7.x86_64 : Very Secure Ftp Daemon
Repo        : base
Matched from:
Filename    : /usr/share/doc/vsftpd-3.0.2/EXAMPLE/INTERNET_SITE_NOINETD/vsftpd.conf
Filename    : /etc/vsftpd/vsftpd.conf  # 目标文件（属于vsftpd）
Filename    : /usr/share/doc/vsftpd-3.0.2/EXAMPLE/VIRTUAL_USERS/vsftpd.conf
Filename    : /usr/share/doc/vsftpd-3.0.2/EXAMPLE/INTERNET_SITE/vsftpd.conf

[root@yangge ~]# yum -y install vsftpd  # 安装vsftpd包
[root@yangge ~]# ls /etc/vsftpd/vsftpd.conf
/etc/vsftpd/vsftpd.conf  # 验证文件已存在
```

**查询文件属于某个包—总结**

```bash
# 查找命令文件（通常在bin或sbin目录）
yum provides "*bin/vim"       # 查找提供vim命令的包
yum provides "*bin/netstat"   # 查找提供netstat命令的包
yum provides "*bin/rz"        # 查找提供rz命令的包

# 查找普通文件（指定具体路径或使用通配符）
yum provides "*/vsftpd.conf"  # 查找提供vsftpd.conf文件的包（*匹配任意父目录）
yum provides "/etc/vsftpd/vsftpd.conf"  # 精确查找指定路径的文件所属包
```

### **三、YUM 基础入门（常用命令）**

| 命令           | 作用               | 示例                               |
| -------------- | ------------------ | ---------------------------------- |
| `yum install`  | 安装软件           | `yum install nginx`                |
| `yum remove`   | 卸载软件           | `yum remove nginx`                 |
| `yum update`   | 更新所有软件       | `yum update`                       |
| `yum search`   | 搜索软件包         | `yum search python3`               |
| `yum list`     | 列出可用软件       | `yum list installed`（已安装的包） |
| `yum info`     | 查看软件信息       | `yum info nginx`                   |
| `yum provides` | 查找文件属于哪个包 | `yum provides /usr/bin/python3`    |

```bash
# 示例：搜索vsftpd相关软件包
[root@yangge ~]# yum search vsftpd
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
====================================== N/S matched: vsftpd ======================================
vsftpd-sysvinit.x86_64 : SysV initscript for vsftpd daemon  # vsftpd的SysV启动脚本
vsftpd.x86_64 : Very Secure Ftp Daemon  # vsftpd主程序包

  Name and summary matches only, use "search all" for everything.  # 提示：默认只匹配名称和摘要，用search all匹配所有

# 示例：查看vsftpd软件包的详细信息
[root@yangge ~]# yum info vsftpd
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
Installed Packages  # 已安装的包
Name        : vsftpd  # 包名
Arch        : x86_64  # 架构
Version     : 3.0.2  # 版本
Release     : 29.el7_9  # 发布版本
Size        : 353 k  # 安装大小
Repo        : installed  # 状态：已安装
From repo   : updates  # 来自updates仓库
Summary     : Very Secure Ftp Daemon  # 摘要
URL         : https://security.appspot.com/vsftpd.html  # 项目地址
License     : GPLv2 with exceptions  # 许可证
Description : vsftpd is a Very Secure FTP daemon. It was written completely from scratch.  # 详细描述

# 查看YUM操作历史
[root@yangge ~]# yum history  # 列出所有YUM操作历史
Loaded plugins: fastestmirror, langpacks
ID     | Login user               | Date and time    | Action(s)      | Altered
-------------------------------------------------------------------------------
    12 | root <root>              | 2025-07-23 14:39 | Install        |    1   # ID 12：安装了1个包
    11 | root <root>              | 2025-07-23 14:33 | Install        |    1   # ID 11：安装了1个包
    10 | root <root>              | 2025-07-23 14:29 | Erase          |    1   # ID 10：卸载了1个包
    # 省略部分输出...

[root@yangge ~]# yum history list 10  # 查看ID为10的历史详情
Loaded plugins: fastestmirror, langpacks
ID     | Command line             | Date and time    | Action(s)      | Altered
-------------------------------------------------------------------------------
    10 | -y remove vim-enh*       | 2025-07-23 14:29 | Erase          |    1   # 执行的命令：卸载vim-enh*

[root@yangge ~]# yum history list 11  # 查看ID为11的历史详情
Loaded plugins: fastestmirror, langpacks
ID     | Command line             | Date and time    | Action(s)      | Altered
-------------------------------------------------------------------------------
    11 | -y install vim-enhanced  | 2025-07-23 14:33 | Install        |    1   # 执行的命令：安装vim-enhanced

[root@yangge ~]# yum history undo 11  # 撤销ID为11的操作（即卸载vim-enhanced）
```

### **四、扩展-创建系统初始化脚本**

#### 1. 创建系统初始化脚本

**[root@yangge ~]# vim init.sh**			# 用vim创建名为init.sh的脚本文件

```shell
#!/bin/bash
# by saocao v1.0  # 脚本作者及版本
# 2025.7.23  # 脚本创建日期

# 删除系统原有的YUM源
rm -rf /etc/yum.repos.d/*
                 
# 配置阿里云基础源（包含base,extras,updates仓库）
curl https://mirrors.aliyun.com/repo/Centos-7.repo -o /etc/yum.repos.d/CentOS-Base.repo
                 
# 配置阿里云EPEL源（提供额外软件包）
curl https://mirrors.aliyun.com/repo/epel-7.repo -o /etc/yum.repos.d/epel.repo
               
# 安装常用基础软件包
yum install -y wget curl vim-enhanced git net-tools bash-completion lrzsz
  
# 关闭防火墙（临时+永久）
systemctl stop firewalld.service
systemctl disable firewalld.service
```

#### 2. 增加执行权限并测试

```bash
[root@yangge ~]# chmod +x init.sh 
[root@yangge ~]# ./init.sh
```

#### 3. 将init.sh传到windows

```bash
[root@yangge ~]# yum -y install lrzsz
[root@yangge ~]# sz init.sh
```

#### 4. 将init.sh传到新安装的Linux

```bash
[root@yangge ~]# rz
- 如果没有rz命令，可以使用其它方法上传文件
```



## CentOS 源码安装 Nginx

### 一、准备工作

#### 1. 准备相对干净环境

```shell
建议恢复到干净的系统，并使用脚本完成初始化
- 配置yum源，包括EPEL
- 停止并禁用防火墙
- 安装基础软件包

[tianyun@yangge ~]$ rz
[tianyun@yangge ~]$ chmod +x init.sh 
[tianyun@yangge ~]$ sudo ./init.sh 
```

#### 2. 安装基础编译工具

```bash
[tianyun@yangge ~]$ yum grouplist								#查看系统提供的软件包组
Loaded plugins: fastestmirror, langpacks
There is no installed groups file.
Maybe run: yum groups mark convert (see man yum)
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
Available Environment Groups:									# 可用的环境组【都未安装】			
   Minimal Install
   Virtualization Host
   Server with GUI
   GNOME Desktop

Available Groups:												# 可用的组【都未安装】
   Cinnamon
   Compatibility Libraries
   Console Internet Tools
   Development Tools											# 开发工具组（库文件，编译工具）
   Educational Software

[tianyun@yangge ~]$ sudo yum install -y "@Development Tools"	#@表示后面是一个软件包组，开发工具组

# 安装Development Tools组之后：
[tianyun@yangge ~]$ yum grouplist
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
Available Environment Groups:
   Minimal Install
   MATE Desktop
   Basic Web Server
Installed Groups:					#Installed Groups表示已安装的组
   Development Tools
Available Groups:
   Cinnamon
   Compatibility Libraries
```

#### 3. 安装Nginx依赖库

```bash
[tianyun@yangge ~]$ sudo yum install -y pcre-devel zlib-devel openssl-devel
```

### 二、下载Nginx源代码

#### 1. Nginx官网获取最新链接

```bash
https://nginx.org/
```

![image-20260106204449936](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260106204449936.png)

#### 2. 下载并解压源代码

```bash
[tianyun@yangge ~]$ wget https://nginx.org/download/nginx-1.28.0.tar.gz		#下载软件包
[tianyun@yangge ~]$ tar -xf nginx-1.28.0.tar.gz								#解压软件包
[tianyun@yangge ~]$ cd nginx-1.28.0/

[tianyun@yangge nginx-1.28.0] ls
auto     CHANGES.ru          conf       contrib          html     man        SECURITY.md
CHANGES  CODE_OF_CONDUCT.md  configure  CONTRIBUTING.md  LICENSE  README.md  src
```

### 三、编译及安装

#### 1. 配置

```bash
[tianyun@yangge ~]$ sudo ./configure \
 --prefix=/usr/local/nginx \
 --user=nginx \
 --sbin-path=/usr/local/nginx/sbin/nginx \
 --conf-path=/etc/nginx/nginx.conf \
 --error-log-path=/var/log/nginx/error.log \
 --with-http_stub_status_module \
 --with-http_ssl_module \
 --with-http_gzip_static_module \
 --with-pcre --with-http_realip_module \
 --with-stream 
 
 Configuration summary
  + using system PCRE library
  + using system OpenSSL library
  + using system zlib library

  nginx path prefix: "/usr/local/nginx"
  nginx binary file: "/usr/local/nginx/sbin/nginx"
  nginx modules path: "/usr/local/nginx/modules"
  nginx configuration prefix: "/etc/nginx"
  nginx configuration file: "/etc/nginx/nginx.conf"
  nginx pid file: "/usr/local/nginx/logs/nginx.pid"
  nginx error log file: "/var/log/nginx/error.log"
  nginx http access log file: "/usr/local/nginx/logs/access.log"
  nginx http client request body temporary files: "client_body_temp"
  nginx http proxy temporary files: "proxy_temp"
  nginx http fastcgi temporary files: "fastcgi_temp"
  nginx http uwsgi temporary files: "uwsgi_temp"
  nginx http scgi temporary files: "scgi_temp"
```

#### 2. 编译

```bash
[tianyun@yangge nginx-1.28.0]$ sudo make
```

#### 3. 安装

```bash
[tianyun@yangge nginx-1.28.0]$ sudo make install
[tianyun@yangge nginx-1.28.0]$ cd
```

### 四、启动Nginx

#### 1. 创建Nginx用户

```bash
[tianyun@yangge ~]$ sudo useradd -r -s /sbin/nologin nginx		# -r 系统用户，UID默认为小于1000
```

#### 2. 启动Nginx服务

```bash
[tianyun@yangge ~]$ sudo /usr/local/nginx/sbin/nginx
```

#### 3. 从浏览器访问Nginx

<div style="background: #f0f0f0; padding: 10px;">
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and working. Further configuration is required.</p>
<p>For online documentation and support please refer to<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at<a href="http://nginx.com/">nginx.com</a>.</p>
<p><em>Thank you for using nginx.</em></p>
</div>

#### 4. 停止Nginx服务

```bash
[tianyun@yangge ~]$ sudo /usr/local/nginx/sbin/nginx -s stop
```

### 五、配置系统服务【扩展】

#### 1. 创建systemd服务文件

```bash
[tianyun@yangge ~]$ sudo vim /etc/systemd/system/nginx.service
```

```ini
[Unit]
Description=nginx
After=network.target
 
[Service]
Type=forking
ExecStart=/usr/local/nginx/sbin/nginx -c /etc/nginx/nginx.conf
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s  stop 
PrivateTmp=true
                                                                             
[Install]
WantedBy=multi-user.target
```

#### 2. 重新加载systemd配置

```bash
[tianyun@yangge ~]$ sudo systemctl daemon-reload
```

#### 3. 启动-重启-停止

```bash
[tianyun@yangge ~]$ sudo systemctl start nginx				# 启动nginx
[tianyun@yangge ~]$ sudo systemctl enable nginx				# 设置为开机自动启动

[tianyun@yangge ~]$ sudo systemctl reload nginx				# 重新加载（非重启）
[tianyun@yangge ~]$ sudo systemctl stop nginx				# 停止nginx

[tianyun@yangge ~]$ systemctl status nginx					# 查看nginx服务状态
● nginx.service - nginx
   Loaded: loaded (/etc/systemd/system/nginx.service; disabled; vendor preset: disabled)
   Active: active (running) since Wed 2025-07-23 16:40:50 CST; 1min 25s ago
  Process: 18396 ExecStart=/usr/local/nginx/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)
 Main PID: 18398 (nginx)
    Tasks: 2
   CGroup: /system.slice/nginx.service
           ├─18398 nginx: master process /usr/local/nginx/sbin/nginx -c /etc/nginx/nginx.conf
           └─18399 nginx: worker process

Jul 23 16:40:50 yangge systemd[1]: Starting nginx...
Jul 23 16:40:50 yangge systemd[1]: Started nginx.
```

###  六、一键安装Nginx【预览】

#### 1. 编写脚本

```bash
[root@yangge ~]# vim nginx_install.sh
#!/bin/bash

# 安装开发工具软件包组
yum install -y "@Development Tools"

# 安装Nginx依赖库
yum install -y pcre-devel zlib-devel openssl-devel

# 下载Nginx软件包
wget https://nginx.org/download/nginx-1.28.0.tar.gz
tar -xf nginx-1.28.0.tar.gz	
cd nginx-1.28.0/

# 安装Nginx
./configure \
 --prefix=/usr/local/nginx \
 --user=nginx \
 --sbin-path=/usr/local/nginx/sbin/nginx \
 --conf-path=/etc/nginx/nginx.conf \
 --error-log-path=/var/log/nginx/error.log \
 --with-http_stub_status_module \
 --with-http_ssl_module \
 --with-http_gzip_static_module \
 --with-pcre --with-http_realip_module \
 --with-stream

make
make install

# 创建Nginx用户
useradd -r -s /sbin/nologin nginx

cat >/etc/systemd/system/nginx.service <<EOF
[Unit]
Description=nginx
After=network.target
 
[Service]
Type=forking
ExecStart=/usr/local/nginx/sbin/nginx -c /etc/nginx/nginx.conf
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s  stop 
PrivateTmp=true
                                                                             
[Install]
WantedBy=multi-user.target
EOF

# 重新加载systemd配置
systemctl daemon-reload

# Nginx启动&开机自动启动
systemctl start nginx				
systemctl enable nginx

echo "Nginx install finish......."
```

#### 2. 新环境运行脚本

```bash
以root用户运行：
[root@yangge ~]# ls -l *.sh
-rwxrwxrwx. 1 root root  575 Jul 23 14:54 init.sh
-rwxrwxrwx. 1 root root 1289 Jul 23 17:11 nginx_install.sh

[root@yangge ~]# ./init.sh
[root@yangge ~]# ./nginx_install.sh
```

## Linux 进程管理

### 一、进程基本概念

```shell
在Linux系统中：
- 进程是程序的运行实例
- 每个进程有唯一的进程ID（PID）process
- 进程有父进程（PPID）parent process
- 进程有运行状态（运行R、睡眠SD、停止T、僵尸Z等）
```

#### 1、进程的生命周期

![](C:\A_bangong\yunjisuan\文档\Linux文档\10 Linux 进程管理\assets\01.jpg.png)

​	

```bash
- 父进程复制自己的地址空间（fork）创建一个新的（子）进程结构。每个新进程分配一个唯一的进程 ID （PID），满足跟踪安全性之需。PID 和 父进程 ID （PPID）是子进程环境的元素，任何进程都可以创建子进程，所有进程都是第一个系统进程（ systemd）的后代。
	
- 子进程继承父进程的安全性身份、过去和当前的文件描述符、端口和资源特权、环境变量，以及程序代码。随后，子进程可能exec自己的程序代码。通常，父进程在子进程运行期间处于睡眠（sleeping）状态。当子进程完成时发出（exit）信号请求，在退出时，子进程已经关闭或丢弃了其资源环境，剩余的部分称之为僵停（僵尸Zombie）。父进程在子进程退出时收到信号而被唤醒，清理剩余的结构，然后继续执行其自己的程序码。

原来只有 1 个进程，通过fork（可以理解为 “复制分身”），变成了两个进程：
一个叫「父进程（parent process）」
一个叫「子进程（child process）」
子进程开始执行任务。。
等子进程把活干完了，就会exit，但这时候它不会直接消失，会先变成「僵尸进程（zombie）」—— 相当于 “留个‘工作完成’的回执单没交”
父进程一开始会wait（等着）,接收子进程留下的退出信号 
```



#### 2、进程的状态

###### ![](C:\A_bangong\yunjisuan\文档\Linux文档\10 Linux 进程管理\assets\02.jpg.png)

```bash
- 在多任务处理操作系统中，每个CPU（或核心）在一个时间点上只能处理一个进程。在进程运行时，它对CPU 时间和资源分配的要求会不断变化，从而为进程分配一个状态，它随着环境要求而改变。

(new) 新进程：刚入职的新员工，还没分配工位、没准备好干活；
Runnable (ready) 就绪态：分到了工位，坐在位置上 “待命”—— 等老板安排任务，随时能开始干活，但暂时没轮到；	
Running (user) 用户态运行：自己干手头的活（比如写报告、做表格），不用麻烦公司资源；
Running (kernel) 内核态运行：干活时需要用公司的资源（比如借打印机、调仓库物资），得找行政 / 后勤协调；
Sleep 睡眠态（图里 K/D/S 都是睡眠）：干活时缺材料（比如等客户发文件、等同事给数据），只能坐在工位上 “等材料”；
Stopped 停止态：老板突然说 “先暂停手里的活”（比如临时开会），暂时停下手头工作；
Zombie 僵尸态：活干完了，下班前留一张 “工作完成的回执单” 在工位上；
X 彻底结束

新员工入职 → 待命：
新员工（new）通过fork（相当于 “办入职”），被公司安排到工位，进入 “待命态（Runnable）”；
待命 → 开始干活：
老板喊 “你开始干吧”（动作run），打工人从 “待命（Runnable）” 进入 “自己干活（Running user）”；
自己干活 → 找公司资源：
干活时需要用打印机（动作syscall），就得从 “自己干活（Running user）” 切换到 “找行政协调（Running kernel）”；
找完资源 → 继续自己干：
行政帮借到了打印机（动作return），又切回 “自己干活（Running user）”；
干活时被打断 → 回待命：	
老板突然喊 “先让别人干”（动作preempt/reschedule），打工人暂停干活，回到 “待命态（Runnable）”；
缺材料 → 等材料：
发现客户文件还没发（动作wait），打工人进入 “等材料（Sleep）”；等文件来了（动作event or signal），再回到 “待命态（Runnable）”；
被临时喊停 → 恢复干活：
老板说 “先开会”（动作suspend），打工人进入 “停止态（Stopped）”；开完会老板说 “继续干”（动作resume），回到 “待命态（Runnable）”；
干完活 → 留回执 → 彻底下班	：
活干完了（动作exit），打工人留张回执单，进入 “僵尸态（Zombie）”；老板收走回执单（动作reap），打工人彻底下班（X）。
```

| 状态 (STAT)                                         | 字母  | 含义                                         | 是否占用 CPU                                             | 是否可被强制杀死                   |
| :-------------------------------------------------- | :---- | :------------------------------------------- | :------------------------------------------------------- | :--------------------------------- |
| **运行/可运行（Running）**                          | **R** | 进程正在CPU执行或在队列中等待执行            | ==**是** (Running)==<br/>**否** (Runnable，但占运行队列) | **是**                             |
| **可中断睡眠（Interruptible Sleep）**               | **S** | 等待某个事件完成，睡眠可被中断               | **否**                                                   | **是**                             |
| **不可中断睡眠(Disk Sleep/Uninterruptible Sleep）** | **D** | 等待硬件I/O，睡眠**不可**被中断              | **否**                                                   | ==**否** (即使是`kill -9`也无效)== |
| **已停止Stopped**                                   | **T** | 进程执行被暂停（挂起）                       | **否**                                                   | **是** (但需先恢复)                |
| **僵尸进程Zombie**                                  | **Z** | 进程已终止，但未被父进程“收尸”，只能重启系统 | **否**                                                   | ==**否** (已死亡，无法杀死)==      |

### 二、查看进程【静态】

####  1、ps - 进程快照

```bash
[root@tianyun ~]# ps aux 
#ps:process status,查看系统进程状态
#a:all,显示所有终端关联的进程
#u:user-oriented,以用户为中心的格式展示进程
#x:without tty,显示无终端关联的后台进程
USER: 			`运行进程的用户`
PID:			`进程ID`
%CPU:  			`CPU占用率`
%MEM: 			`内存占用率`
VSZ:			`占用虚拟内存`
RSS:  			`占用实际内存(驻留内存)``
TTY:			`进程运行的终端`

STAT:				`进程状态`		
  R 				`运行`
  S 				`可中断睡眠`
  D					`不可中断睡眠`
  T 				`停	止的进程`
  Z 				`僵尸进程`
  X    			    `死掉的进程`    
  Ss  				`s进程的领导者，父进程`
  S< 				`<优先级较高的进程`
  SN  				`N优先级较低的进程`
  R+				`+表示是前台的进程组`
  Sl				`以线程的方式运行`
  
START:			`进程的启动时间`
TIME:			`进程占用CPU的总时间`
command         `程序路径`
```

```shell
- 进程管理学习环境准备
[root@tianyun ~]# yum install -y httpd  	# 安装Apache
[root@tianyun ~]# systemctl start httpd 	# 启动Apache
```

**ps命令必备技巧一：ps aux**

```shell
[root@tianyun ~]# ps aux --sort=-%cpu |head 		# 排序，按CPU占比排序, -表示降序,不加表示升序
[root@tianyun ~]# ps aux --sort=-%mem |head			# 按内存占比排序
```

**ps命令必备技巧二：ps -eo 显示自定义字段**

```shell
[root@tianyun ~]# ps -eo cmd,pid,ppid,user,%cpu,%mem,stat,start_time |head 
#-e:every（all processes），显示系统所有进程
#-o:output（output format），自定义指定输出列
CMD                            PID   PPID USER     %CPU %MEM STAT START
/usr/lib/systemd/systemd --      1      0 root      0.0  0.3 Ss   Jun18
[kthreadd]                       2      0 root      0.0  0.0 S    Jun18
[kworker/0:0H]                   4      2 root      0.0  0.0 S<   Jun18
[ksoftirqd/0]                    6      2 root      0.0  0.0 S    Jun18
[migration/0]                    7      2 root      0.0  0.0 S    Jun18
[rcu_bh]                         8      2 root      0.0  0.0 S    Jun18
[rcu_sched]                      9      2 root      0.0  0.0 R    Jun18
[lru-add-drain]                 10      2 root      0.0  0.0 S<   Jun18
[watchdog/0]                    11      2 root      0.0  0.0 S    Jun1	

cmd		进程名
pid		进程ID
ppid	父进程ID
user	运行用户
%cpu	CPU使用率
%mem	内存使用率
stat	进程状态status
start_time	进程启动时间

[root@tianyun ~]# ps -eo cmd,pid,%cpu |head 
CMD                            PID %CPU
/usr/lib/systemd/systemd --      1  0.0
[kthreadd]                       2  0.0
[kworker/0:0H]                   4  0.0
[ksoftirqd/0]                    6  0.0
[migration/0]                    7  0.0
[rcu_bh]                         8  0.0
[rcu_sched]                      9  0.0
[lru-add-drain]                 10  0.0
[watchdog/0]                    11  0.0

[root@tianyun ~]# ps -eo cmd,pid,%cpu --sort=-%cpu |head
CMD                            PID %CPU
/usr/bin/vmtoolsd              754  0.1
/usr/bin/gnome-shell         19907  0.1
/usr/lib/systemd/systemd --      1  0.0
[kthreadd]                       2  0.0
[kworker/0:0H]                   4  0.0
[ksoftirqd/0]                    6  0.0
[migration/0]                    7  0.0
[rcu_bh]                         8  0.0
[rcu_sched]                      9  0.0

[root@tianyun ~]# ps -eo cmd,pid,%cpu,%mem --sort=-%mem |head
CMD                            PID %CPU %MEM
/usr/bin/gnome-shell         19907  0.1  7.7
/usr/bin/gnome-software --g  20230  0.0  5.3
/usr/bin/X :0 -background n  19412  0.0  2.2
/usr/libexec/gnome-terminal  22279  0.0  1.0
/usr/bin/python2 -Es /usr/s   1233  0.0  0.9
nautilus-desktop --force     20199  0.0  0.8
/usr/sbin/libvirtd            1243  0.0  0.7
/usr/libexec/tracker-store   20319  0.0  0.7
/usr/libexec/gsd-xsettings   20091  0.0  0.6
```

#### **2、pstree - 进程树**

```bash
[root@bogon ~]# yum install -y psmisc
[root@tianyun ~]# pstree 
#pstree:process tree
systemd─┬─NetworkManager─┬─dhclient
        │                └─2*[{NetworkManager}]
        ├─VGAuthService
        ├─auditd───{auditd}
        ├─chronyd
        ├─crond
        ├─dbus-daemon───{dbus-daemon}
        ├─httpd───5*[httpd]
        ├─irqbalance
        ├─login───bash
        ├─lvmetad
        ├─master─┬─pickup
        │        └─qmgr
        ├─polkitd───6*[{polkitd}]
        ├─rsyslogd───2*[{rsyslogd}]
        ├─sshd───sshd───bash───pstree
        ├─systemd-journal
        ├─systemd-logind
        ├─systemd-udevd
        ├─tuned───4*[{tuned}]
        └─vmtoolsd───2*[{vmtoolsd}]

[root@tianyun ~]# pstree |grep httpd
        |-httpd---5*[httpd]										# 5*表示5个此名进程
		
[root@tianyun ~]# pstree -p |grep httpd	 # 显示带有PID的进程树-p   
#-p:--show-pids显示每个进程的 PID 编号
           |-httpd(1704)-+-httpd(1706)
           |             |-httpd(1707)
           |             |-httpd(1708)
           |             |-httpd(1709)
           |             `-httpd(1710)
           					
[root@tianyun ~]# pstree -u tianyun		#-u:--user 查看tom用的进程
No processes found.

[root@tianyun ~]# pstree -u tianyun						# 换个终端登录为tianyun
bash

[root@tianyun ~]# pstree -u tianyun -p
bash(1722)


[root@tianyun ~]# pstree -p |grep httpd
           |-httpd(1704)-+-httpd(1706)
           |             |-httpd(1707)
           |             |-httpd(1708)
           |             |-httpd(1709)
           |             `-httpd(1710)
           					
[root@tianyun ~]# pstree -ps 1708	#查看某个进程（PID）的完整父子关系 -s:--show-parents 
systemd(1)───httpd(1704)───httpd(1708)
 
[root@tianyun ~]# pstree -ps 1704
systemd(1)───httpd(1704)─┬─httpd(1706)
                         ├─httpd(1707)
                         ├─httpd(1708)
                         ├─httpd(1709)
                         └─httpd(1710)
```

#### 3、**lsof - 查看端口占用 **

```bash
[root@tianyun ~]# yum -y install lsof
[root@tianyun ~]# lsof -i :80
#lsof:list open files,列出系统中所有被进程打开的文件
#-i:internet，筛选网络文件并关联到对应进程
#:端口号
COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
httpd   1704   root    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1706 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1707 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1708 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1709 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1710 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
字段名	含义说明
COMMAND	占用端口的进程名称（比如httpd是 Apache 服务，sshd是 SSH 服务）
PID	进程的唯一 ID（可以用kill PID终止对应进程）
USER	运行该进程的用户（比如root是管理员用户，apache是 Web 服务专用用户）
FD:File Descriptor,进程打开的文件描述符：
4u中4是描述符编号，u表示 “可读可写”如u、r、w,u=rw r w	
TYPE	网络类型（这里是IPv4/IPv6，代表网络协议版本）
DEVICE	设备编号（系统内部标识，一般不用关注）
SIZE/OFF	文件大小 / 偏移量（网络连接场景下通常无实际值）
NODE	索引节点号（系统内部标识）
NAME	网络连接信息：
*:http表示监听本机所有 IP 的 80 端口（http对应 80）；
LISTEN表示 “正在监听请求”；
ESTABLISHED表示 “已建立的连接”

[root@tianyun ~]# lsof -i :22
COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
sshd    1136 root    3u  IPv4  21683      0t0  TCP *:ssh (LISTEN)
sshd    1136 root    4u  IPv6  21685      0t0  TCP *:ssh (LISTEN)
sshd    1620 root    3u  IPv4  25724      0t0  TCP tianyun:ssh->tianyun:57956 (ESTABLISHED)

# 案例
[root@tianyun ~]# yum -y install nginx
[root@tianyun ~]# systemctl start nginx
Job for nginx.service failed because the control process exited with error code. See "systemctl status nginx.service" and "journalctl -xe" for details.

Nginx服务启动失败！！！ 提醒查看日志 journalctl -xe

[root@tianyun ~]# journalctl -xe
Jul 24 11:43:11 tianyun nginx[1843]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address alread
Jul 24 11:43:11 tianyun nginx[1843]: nginx: [emerg] bind() to [::]:80 failed (98: Address already i
Jul 24 11:43:11 tianyun nginx[1843]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address alread

通过日志发现，80端口补占用。需要找到是哪个进程占用了80端口
[root@tianyun ~]# lsof -i :80
COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
httpd   1704   root    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1706 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1707 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1708 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1709 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)
httpd   1710 apache    4u  IPv6  24895      0t0  TCP *:http (LISTEN)

[root@tianyun ~]# systemctl stop httpd				# 停止Apache服务
[root@tianyun ~]# systemctl disable httpd			# 设置开机不自动运行

[root@tianyun ~]# lsof -i :80									# 再次查看80端口是否被占用，目前未占用
[root@tianyun ~]# systemctl start nginx				# 再次启动Nginx服务，正常

作业： 学习lsof命令
```

#### 4、netstat - 查看监听端口

```shell
client -----> 192.168.92.148 ???				# 不知道要访问什么服务

client (ssh) 	-----> 	192.168.92.148:22		# sshd远程连接服务
client (http://) ----> 	192.168.92.148:80		# Web服务（Nginx,Apache）
client (mysql) 	-----> 	192.168.92.148:3306		# MySQL数据库服务
client (ftp://) -----> 	192.168.92.148:21		# FTP服务

# 查看网络进程 和 正在监听（LISTEN）的端口
[root@tianyun ~]# netstat -tnlp    (该命令对应的包名：net-tools)
参数详解：
-u  udp传输协议（飞机运输）
-t  tcp传输协议（火车运输）
-p  显示进程的名称和pid
-l 	只显示正在被监听(LISTEN)端口的状态 
-a 	显示端口的所有状态(LISTEN,ESTABLISHED,CLOSED...)
-n  不解析don't resolve names，例如别将80解析为http

# 显示所有监听的端口LISTEN
[root@tianyun ~]# netstat -tnlp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1920/nginx: master  
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1136/sshd           
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1309/master         
tcp6       0      0 :::80                   :::*                    LISTEN      1920/nginx: master  
tcp6       0      0 :::22                   :::*                    LISTEN      1136/sshd           
tcp6       0      0 ::1:25                  :::*                    LISTEN      1309/master  

# 显示所有监听的端口LISTEN（未加p，不显示PID和进程名）
[root@tianyun ~]# netstat -tnl
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN     
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN     
tcp6       0      0 :::80                   :::*                    LISTEN     
tcp6       0      0 :::22                   :::*                    LISTEN     
tcp6       0      0 ::1:25                  :::*                    LISTEN 

# 显示所有监听的端口LISTEN（未加n，不解析don't resolve names，例如不要将80解析为http）
[root@tianyun ~]# netstat -tlp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:http            0.0.0.0:*               LISTEN      1920/nginx: master  
tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN      1136/sshd           
tcp        0      0 localhost:smtp          0.0.0.0:*               LISTEN      1309/master         
tcp6       0      0 [::]:http               [::]:*                  LISTEN      1920/nginx: master  
tcp6       0      0 [::]:ssh                [::]:*                  LISTEN      1136/sshd           
tcp6       0      0 localhost:smtp          [::]:*                  LISTEN      1309/master  

# 显示端口的所有状态（-a）
[root@tianyun ~]# netstat -tnap
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1920/nginx: master  
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1136/sshd           
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      1309/master         
tcp        0     36 192.168.92.148:22       192.168.92.1:57956      ESTABLISHED 1620/sshd: root@pts 
tcp6       0      0 :::80                   :::*                    LISTEN      1920/nginx: master  
tcp6       0      0 :::22                   :::*                    LISTEN      1136/sshd           
tcp6       0      0 ::1:25                  :::*                    LISTEN      1309/master  

# 查看22号端口是否在监听（LISTEN）
[root@tianyun ~]# netstat -tnlp |grep :22
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1136/sshd           
tcp6       0      0 :::22                   :::*                    LISTEN      1136/sshd

# 查看22号端口的所有状态（LISTEN,ESTABLISHED.....）
[root@tianyun ~]# netstat -tnap |grep :22
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1136/sshd           
tcp        0     36 192.168.92.148:22       192.168.92.1:57956      ESTABLISHED 1620/sshd: root@pts 
tcp6       0      0 :::22                   :::*                    LISTEN      1136/sshd  

# 查看80号端口是否在监听（LISTEN）
[root@tianyun ~]# netstat -tnlp |grep :80
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1920/nginx: master  
tcp6       0      0 :::80                   :::*                    LISTEN      1920/nginx: master      

# 查看80号端口的所有状态（LISTEN,ESTABLISHED.....）
[root@tianyun ~]# netstat -tnap |grep :80
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1920/nginx: master  
tcp        0      0 192.168.92.148:80       192.168.92.1:56015      ESTABLISHED 1921/nginx: worker  
tcp        0      0 192.168.92.148:80       192.168.92.1:56011      ESTABLISHED 1921/nginx: worker  
tcp        0      0 192.168.92.148:80       192.168.92.1:56013      ESTABLISHED 1924/nginx: worker  
tcp6       0      0 :::80                   :::*                    LISTEN      1920/nginx: master


ss命令功能和netstat等价
```

#### 5、ss - 查看监听端口

### 三、查看进程【动态】

#### 1、**top** - 实时系统监控       

`top` 界面分为 **顶部汇总信息** 和 **进程列表** 两部分：

**顶部汇总信息**

```
top - 14:30:45 up 10 days,  3:45,  2 users,  load average: 0.15, 0.10, 0.05
Tasks: 120 total,   2 running, 118 sleeping,   0 stopped,   0 zombie
%Cpu(s):  5.3 us,  1.2 sy,  0.0 ni, 93.5 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem :   7845.2 total,   1024.5 free,   4096.3 used,   2724.4 buff/cache
MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.   3200.2 avail Mem
```

- **第 1 行**（系统运行状态）：

  - `14:30:45`：当前时间
  - `up 10 days, 3:45`：系统已运行时间
  - `load average: 0.15, 0.10, 0.05`：系统 **1 分钟、5 分钟、15 分钟** 的平均负载（`≤ CPU 核心数` 表示正常）

  ![](C:\A_bangong\yunjisuan\文档\Linux文档\10 Linux 进程管理\assets\03.jpg.png)

- **第 2 行**（任务状态）：

  - `Tasks: 120 total`：总进程数
  - `2 running`：正在运行的进程数
  - `118 sleeping`：休眠的进程数
  - `0 stopped`：停止的进程数
  - `0 zombie`：僵尸进程数（若不为 0，需检查）

- **第 3 行**（CPU 使用情况）：

  - `5.3 us`：用户空间占用 CPU 百分比
  - `1.2 sy`：内核空间占用 CPU 百分比
  - `93.5 id`：空闲 CPU 百分比
  - `0.0 wa`：I/O 等待占用 CPU 百分比（若高，可能磁盘瓶颈）
  - `0.0 st`：虚拟机偷取时间（仅虚拟化环境）

- **第 4 行**（内存使用情况）：

  - `7845.2 total`：总内存（MiB）
  - `1024.5 free`：空闲内存
  - `4096.3 used`：已用内存
  - `2724.4 buff/cache`：缓存/缓冲区内存（可释放）

- **第 5 行**（交换分区 Swap）：

  - `2048.0 total`：Swap 总大小
  - `2048.0 free`：空闲 Swap
  - `0.0 used`：已用 Swap（若高，可能内存不足）

**进程列表**

```
  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
 1234 root      20   0  123456  78912   3456 R   6.2  1.0   5:30.45 firefox
 5678 mysql     20   0  456789 123456  67890 S   3.1  1.5  10:15.30 mysqld
```

| 列名        | 说明                                                       |
| ----------- | ---------------------------------------------------------- |
| **PID**     | 进程 ID                                                    |
| **USER**    | 进程所属用户                                               |
| **PR**      | 进程优先级（值越小优先级越高）                             |
| **NI**      | Nice 值（-20 最高优先级，19 最低）                         |
| **VIRT**    | 进程使用的虚拟内存（KB）                                   |
| **RES**     | 进程使用的物理内存（KB）                                   |
| **SHR**     | 共享内存大小（KB）                                         |
| **S**       | 进程状态（`R`=运行, `S`=休眠, `Z`=僵尸, `D`=不可中断休眠） |
| **%CPU**    | 进程占用 CPU 百分比                                        |
| **%MEM**    | 进程占用内存百分比                                         |
| **TIME+**   | 进程占用 CPU 时间（格式 `分:秒.毫秒`）                     |
| **COMMAND** | 进程命令名                                                 |

**`top` 交互命令**

在 `top` 运行时，可以按以下快捷键操作：

| 快捷键          | 功能                                                 |
| --------------- | ---------------------------------------------------- |
| **`q`**         | 退出 `top`                                           |
| **`k`**         | 杀死进程（输入 PID，再输入信号，默认 `15`）          |
| **`r`**         | 调整进程优先级（输入 PID，再输入 `Nice` 值）         |
| **`P`**         | 按 **CPU 使用率** 排序                               |
| **`M`**         | 按 **内存使用率** 排序                               |
| **`T`**         | 按 **CPU 时间** 排序                                 |
| **`1`**         | 显示 **所有 CPU 核心** 的单独使用情况                |
| **`h`**         | 显示帮助菜单                                         |
| **`Shift + >`** | 向右滚动进程列表（查看完整命令）                     |
| **`Shift + <`** | 向左滚动进程列表                                     |
| **`z`**         | 切换颜色显示                                         |
| **`W`**         | 保存当前 `top` 配置到 `~/.toprc`（下次启动自动加载） |

---

**`top` 命令行参数**

```bash
[root@tianyun ~]# top -d 5     #-d:delay延迟/间隔,设置刷新间隔为 5 秒
[root@tianyun ~]# top -p 1234,5678  #-p:Process ID,仅监控 PID 1234 和 5678
[root@tianyun ~]# top -u apache  #-u:user用户，仅显示 apache 用户的进程
[root@tianyun ~]# top -b -n 3 > top.log #-b:batch批处理,以批处理模式运行 3 次，输出到文件 
[root@tianyun ~]# top -u apache  -b -n 3 > top.txt	#-n:number,批处理模式查看apache用户的进程3次，输出文件
```

#### 2、**htop** - 实时系统监控

```shell
[root@tianyun ~]# yum list htop
Loaded plugins: fastestmirror, langpacks
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
Available Packages
htop.x86_64            2.2.0-3.el7                       epel

[root@tianyun ~]# yum -y install htop
[root@tianyun ~]# htop

注：htop软件包由EPEL源提供
```

### 四、进程控制 - kill

```shell
[root@linux-server ~]# kill -l   #查看所有信号
 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP
 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1
11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM
16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP
21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR
31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX

-1   HUP:Hang up  重新加载reload进程或者重新加载配置文件，PID不变
-9   KILL 强制杀死
-15  TERM:Terminate 正常终止(这个信号可以默认不写)

-18  CONT:Continue 激活进程
-19  STOP 挂起（暂停）进程
```

#### **kill案例一**

```shell
以Apache为实验场景，把Nginx关闭

[root@bogon ~]# systemctl stop httpd		# 停止Apache（httpd）服务 相当于信号15
[root@bogon ~]# systemctl restart httpd		# 重启Apache（httpd）服务
```

```shell
[root@bogon ~]# ps aux |grep httpd			# 查看当前是否启动	
root      38466  0.1  0.2 230444  5232 ?        Ss   11:06   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38471  0.0  0.1 232528  3152 ?        S    11:06   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38472  0.0  0.1 232528  3152 ?        S    11:06   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38473  0.0  0.1 232528  3152 ?        S    11:06   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38474  0.0  0.1 232528  3152 ?        S    11:06   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38475  0.0  0.1 232528  3152 ?        S    11:06   0:00 /usr/sbin/httpd -DFOREGROUND

[root@bogon ~]# kill -15 38466				# 发送正常的停止信号
[root@bogon ~]# ps aux |grep httpd
root      38535  0.0  0.0 112808   968 pts/1    S+   11:10   0:00 grep --color=auto httpd


[root@bogon ~]# systemctl start httpd
[root@bogon ~]# ps aux |grep httpd
root      38551  1.0  0.2 230444  5228 ?        Ss   11:11   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38555  0.0  0.1 232528  3148 ?        S    11:11   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38556  0.0  0.1 232528  3148 ?        S    11:11   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38557  0.0  0.1 232528  3148 ?        S    11:11   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38558  0.0  0.1 232528  3148 ?        S    11:11   0:00 /usr/sbin/httpd -DFOREGROUND
apache    38559  0.0  0.1 232528  3148 ?        S    11:11   0:00 /usr/sbin/httpd -DFOREGROUND

[root@bogon ~]# killall httpd				# killall跟进程名，信号15为默认信号
[root@bogon ~]# ps aux |grep httpd
root      38589  0.0  0.0 112808   968 pts/1    R+   11:12   0:00 grep --color=auto httpd
```

#### **kill案例二**

```shell
信号TERM 15（正常终止）
[root@bogon ~]# vim /etc/hosts			 	# 打开着，等待接收信号
[root@bogon ~]# ps aux |grep vim
root      38654  0.0  0.2 149300  5040 pts/0    S+   11:15   0:00 vim /etc/hosts
[root@bogon ~]# kill -15 38654				
发送信号后，观察vim变化

信号KILL 9（强制终止）
[root@bogon ~]# vim /etc/hosts			 	# 重新打开，等待接收信号
[root@bogon ~]# ps aux |grep vim
root      38732  0.0  0.2 149300  5060 pts/0    S+   11:20   0:00 vim /etc/hosts
[root@bogon ~]# kill -9 38732
发送信号后，观察vim变化
Found a awap file by the name "/etc/.hosts.swp"	 # 产生了交换文件
```

### 五、其它命令

#### **1. 查看当前CPU负载**  

```shell
[root@linux-server ~]# uptime 
 17:35:01 up 16:02,  3 users,  load average: 0.00, 0.02, 0.05
```

#### **2. 查看内存使用**

```shell
[root@bogon ~]# free -m
              total        used        free      shared  buff/cache   available
Mem:           1819         858         156          21         804         768
Swap:          2047          16        2031

[root@bogon ~]# free -h
              total        used        free      shared  buff/cache   available
Mem:           1.8G        858M        156M         21M        804M        768M
Swap:          2.0G         16M        2.0G
```

#### **3. 查看系统的版本和内核**

```shell
[root@linux-server ~]# cat /etc/redhat-release  #查看版本
CentOS Linux release 7.4.1708 (Core)

[root@linux-server ~]# uname -r  #查看内核版本
3.10.0-693.el7.x86_64
```

#### **4. 查看CPU相关信息**

```bash
[root@bogon ~]# lscpu 							# 查看cpu相关信息
Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                32						# CPU总的数量
On-line CPU(s) list:   0-31
Thread(s) per core:    2						# 每个核心的线程数
Core(s) per socket:    8						# 每个物理CPU的核数
Socket(s):             2						# 物理CPU的数量

[root@bogon ~]# nproc							# 统计CPU的数量
32
```

```shell
查看服务器CPU架构
[root@tianyun ~]# lscpu
Architecture:          x86_64

[root@tianyun ~]# uname -m
x86_64

# 输出示例：
x86_64    # 表示x86_64架构
aarch64   # 表示ARM64架构
ppc64le   # 表示POWER架构

https://www.centos.org		
CentOS-Stream-9-latest-x86_64-dvd1.iso			# X86_64架构镜像
CentOS-Stream-9-latest-aarch64-dvd1.iso			# ARM架构镜像

https://ubuntu.com

注：CPU架构影响到系统镜像ISO文件的选择，以及软件包的选择
```



### 五、作业管理job

```bash
# 案例I
[root@tianyun ~]# vim /etc/hosts 					# ^Z将其暂停到后台

[1]+  Stopped                 vim top.txt
[root@bogon ~]# ps aux |grep vim					# T状态表示STOP
root      41099  0.0  0.2 149316  5068 pts/1    T    14:43   0:00 vim top.txt
root      41101  0.0  0.0 112808   964 pts/1    S+   14:43   0:00 grep --color=auto vim

[root@tianyun ~]# date								# 模拟做了一些其它的工作
[root@tianyun ~]# fg								# 将其调回到前台

# 案例II
[root@tianyun ~]# vim yangge.txt					# ^Z将其暂停到后台
[root@tianyun ~]# top								# ^Z将其暂停到后台

[root@tianyun ~]# jobs 								# 查看后台作业
[1]-  Stopped                 vim yang
[2]+  Stopped                 top

[root@tianyun ~]# fg								# 将最新的一个作业调回到前台(top)
[root@tianyun ~]# fg 1								# 将作业号1的进程调回到前台(vim)，也可以fg %1

# 案例III
[root@tianyun ~]# sleep 5000						# 默认为前台运行，^Z将其暂停到后台
^Z
[1]+  Stopped                 sleep 5000		
[root@tianyun ~]# ps aux |grep sleep				# sleep进程在后台目前为停止状态 T
root      16161  0.0  0.0 108052   352 pts/0    T    09:38   0:00 sleep 5000
root      16165  0.0  0.0 112808   964 pts/0    S+   09:39   0:00 grep --color=auto sleep

[root@tianyun ~]# bg 1								# 让作业号为1的进程，在后台运行
[1]+ sleep 5000 &
[root@tianyun ~]# jobs 			
[1]+  Running                 sleep 5000 &
[root@tianyun ~]# ps aux |grep sleep
root      16161  0.0  0.0 108052   352 pts/0    S    09:38   0:00 sleep 5000
root      16167  0.0  0.0 112808   964 pts/0    S+   09:40   0:00 grep --color=auto sleep


[root@tianyun ~]# sleep 6000 &						# 一启动，就注定在后台运行
[1] 16168											# 1为作业号，16168为PID

[root@tianyun ~]# jobs
[1]+  Running                 sleep 6000 &

[root@tianyun ~]# kill 16168						# 使用PID杀（发信号）
[root@tianyun ~]# kill %1							# 使用作业号杀（发信号），kill 1表示PID为1的进程
[root@tianyun ~]# jobs
[1]+  Terminated              sleep 6000
#fg:foreground,前台
#bg:background,后台
#Ctrl+z将进程转为后台stopped状态再结合bg 作业号让他后台running
#fg 作业号将后台的running/stopped 状态的进程转到前台运行
```

### 六、学习作业

```shell
1.需要修改/etc/passwd文件属性。要求只可以追加，不允许修改。
2./tmp/im 为新员工手册，要求修改文件属性，不可以修改文件内容，只可以查看文件内容
3.chattr命令中a和i属性的区别
4.静态查看进程有用什么命令？你知道的有几种？
5.修改主机名为testpm-server
6.如何查看服务的端口？
7.如何查看nginx的进程是否运行？
8.如何查看你的操作系统的版本以及内核？
9.什么是进程？
10.使用那个命令可以查看正在运行的httpd服务的PID号？
11.放在后台运行的程序通过什么命令可以查看到？
12.将nginx进程PID号为1142强制杀掉用什么命令？
13.请列出查看cpu负载的命令你知道的？
14.load average： 0.40，0.21，0.12 分别代表什么意思？
```

### **七、扩展知识-常用协议及对应端口**

---

```bash
/etc/services
0-1023: 知名端口
```

#### **1. 基础网络协议【重点关注】**

| 协议      | 端口  | 说明                      | 典型应用       |
| --------- | ----- | ------------------------- | -------------- |
| **HTTP**  | 80    | 超文本传输协议            | 网页浏览       |
| **HTTPS** | 443   | 加密的HTTP                | 安全网页/API   |
| **FTP**   | 20/21 | 文件传输协议（数据/控制） | 文件上传下载   |
| **SSH**   | 22    | 安全Shell协议             | 远程管理服务器 |

#### **2. 邮件协议**

| 协议      | 端口 | 说明                     |
| --------- | ---- | ------------------------ |
| **SMTP**  | 25   | 邮件发送协议（明文）     |
| **SMTPS** | 465  | 加密的SMTP               |
| **POP3**  | 110  | 邮件接收协议（明文）     |
| **POP3S** | 995  | 加密的POP3               |
| **IMAP**  | 143  | 高级邮件接收协议（明文） |
| **IMAPS** | 993  | 加密的IMAP               |

#### 3. 数据库协议【MySQL-Redis】

| 协议           | 端口  | 对应数据库                               |
| -------------- | ----- | ---------------------------------------- |
| **MySQL**      | 3306  | MySQL/MariaDB                            |
| **PostgreSQL** | 5432  | PostgreSQL                               |
| **Redis**      | 6379  | Redis                                    |
| **MongoDB**    | 27017 | MongoDB                                  |
| **Oracle**     | 1521  | Oracle Database【IBM公司付费产品】       |
| **SQL Server** | 1433  | Microsoft SQL Server【微软公司付费产品】 |

---

#### **4. 远程访问协议**

| 协议               | 端口  | 安全级别                      |
| ------------------ | ----- | ----------------------------- |
| **RDP**            | 3389  | Windows远程桌面（建议改端口） |
| **VNC**            | 5900+ | 图形化远程控制（通常加密）    |
| **TeamViewer**     | 5938  | 第三方远程工具                |
| **向日葵远程控制** |       |                               |

#### 5. 文件共享协议【了解】

| 协议      | 端口 | 说明            |
| --------- | ---- | --------------- |
| **SMB**   | 445  | Windows文件共享 |
| **NFS**   | 2049 | Linux文件共享   |
| **Rsync** | 873  | 增量文件同步    |

---

#### 6. 网络安全协议

| 协议          | 端口     | 用途                  |
| ------------- | -------- | --------------------- |
| **IPSec**     | 500/4500 | VPN加密通道           |
| **OpenVPN**   | 1194     | 开源VPN（建议改端口） |
| **WireGuard** | 51820    | 现代轻量VPN           |

---

#### 7. 监控与管理协议

| 协议           | 端口    | 工具         |
| -------------- | ------- | ------------ |
| **SNMP**       | 161/162 | 网络设备监控 |
| **Prometheus** | 9090    | 指标采集     |
| **Grafana**    | 3000    | 数据可视化   |

## Linux 提权sudo 

### 一、sudo基础概念

sudo（superuser do）是Linux系统中允许特定用户以其他用户身份（通常是root）执行命令的工具，相比直接使用root账户更安全。

#### sudo优势：

- 细粒度的权限控制
- 命令执行记录可审计
- 避免共享root密码
- 可限制特定用户执行特定命令

```bash
- Ubuntu系统安装过程中，创建的普通用户默认为sudo用户。

- CentOS系统安装过程中，创建普通用户时，如果选择了这个小勾，同上。
```

![11 Linux 提权sudo](C:\A_bangong\yunjisuan\文档\Linux文档\合并大文档\assets\11 Linux 提权sudo.png)

### 二、最快的方法使用sudo

#### 1. 加入到wheel组

在 CentOS/RHEL 等 Linux 系统中，`wheel` 组是一个**用于控制 “哪些用户可以用 sudo 提权” 的管理组**。只有加入`wheel`组的用户，才能通过`sudo`执行需要管理员权限的命令。

```bash
[root@tianyun ~]# useradd zhuzhuxia -G wheel		# 新建用户时，直接加入wheel组
	
[root@tianyun ~]# useradd alice					
[root@tianyun ~]# gpasswd -a alice wheel			# 将老用户加入wheel组
Adding user alice to group wheel
[root@tianyun ~]# id alice
uid=1001(alice) gid=1001(alice) groups=1001(alice),10(wheel)
```

#### 2. 测试sudo

`sudo`的作用是**让普通用户临时获得管理员（root）权限**，执行需要高权限的操作。

```bash
[alice@tianyun ~]$ sudo useradd user1
[sudo] password for alice: 							

sudo：触发提权，要求输入当前用户（alice）的密码（不是 root 密码）；
useradd user1：创建新用户user1（这个操作默认需要 root 权限）；

[alice@tianyun ~]$ sudo passwd user1
Changing password for user user1.
New password: 
BAD PASSWORD: The password is a palindrome
Retype new password: 
passwd: all authentication tokens updated successfully.

[alice@tianyun ~]$ sudo yum -y install vsftpd
yum是 CentOS 的包管理器，install vsftpd是安装 FTP 服务软件；
加sudo后，以 root 权限执行安装，-y表示自动确认所有提示，最终完成vsftpd的安装。
```

### 三、sudo配置文件解析

#### 主配置文件路径：

```
/etc/sudoers
```

#### 推荐编辑方式（避免语法错误）：

直接编辑`/etc/sudoers`容易因**语法错误导致 sudo 功能失效**，所以推荐用`visudo`命令编辑

```bash
[root@tianyun ~]# visudo

## Allows people in group wheel to run all commands
%wheel  ALL=(ALL)       ALL							# 最后ALL，任何命令

%wheel：表示 “wheel 组的所有用户”（%是组的标识）；
第一个ALL：表示 “在所有主机上生效”（如果是多主机环境，可指定具体主机）；
(ALL)：表示 “可以以ALL（即 root）的身份执行命令”；
第二个ALL：表示 “可以执行所有命令”（也可以指定具体命令，如/usr/sbin/useradd）。

## Same thing without a password
# %wheel        ALL=(ALL)       NOPASSWD: ALL		
前半部分和上面规则一致，NOPASSWD: ALL表示 “执行任何 sudo 命令时，不需要输入自己的密码”；
注意：免密配置存在安全风险，一般仅在可信环境或自动化脚本中使用。
```

### 四、实战配置案例	

#### 案例1：允许用户执行所有命令(搜索anywhere关键词，调到配置权限位置)

```bash
[root@tianyun ~]# visudo
yangge ALL=(ALL)       NOPASSWD: ALL

01 ALL: 从任何主机
02 ALL: 以任何用户的身份，包括root
03 ALL: 执行任何命令
NOPASSWD: 不需要自己的密码（防止当前坐在电脑前的不是你）

测试：
[yangge@tianyun ~]$ sudo useradd user40
[yangge@tianyun ~]$ id user40
[yangge@tianyun ~]$ sudo yum -y install ftp

- 以上操作等价于将用户加入到wheel组
```

#### 案例2：允许用户组执行所有命令

```bash
[root@alice ~]# groupadd it
[root@alice ~]# useradd it01 -G it
[root@alice ~]# useradd it02 -G it

[root@alice ~]# visudo
%it     ALL=(ALL)       NOPASSWD: ALL

测试：
[root@alice ~]# su - it01
[it01@alice ~]$ useradd user50
useradd: Permission denied.
useradd: cannot lock /etc/passwd; try again later.
[it01@alice ~]$ sudo useradd user50
```

#### 案例3：允许执行特定命令（用which 命令，type 命令进行查找 ）

```bash
tom ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart httpd

alice  ALL=(ALL)  NOPASSWD: /bin/cat, /usr/sbin/userdel

测试：
[alice@alice ~]$ cat /etc/shadow						# 以alice自己身份运行cat是看不了shadow文件
cat: /etc/shadow: Permission denied
[alice@alice ~]$ ls -l /etc/shadow
----------. 1 root root 1762 Jul 22 11:05 /etc/shadow

[alice@alice ~]$ sudo cat /etc/shadow					# 以root的身份运行cat

[alice@alice ~]$ sudo useradd user60
[sudo] password for alice: 
Sorry, user alice is not allowed to execute '/sbin/useradd user60' as root on alice.
[alice@alice ~]$ sudo userdel user40
```

#### 案例4：定义命令别名

```bash
用户管理员：
/usr/sbin/useradd
/usr/sbin/usermod
/usr/sbin/userdel
/usr/bin/passwd
/usr/sbin/groupadd
/usr/sbin/groupmod
/usr/sbin/groupdel
/usr/bin/gpasswd

要求：将alice、tom、jack都设置为用户管理员

【方法一：传统笨】
alice  ALL=(ALL)  NOPASSWD: /usr/sbin/useradd, /usr/sbin/usermod, /usr/sbin/userdel, /usr/sbin/groupadd, /usr/sbin/groupmod, /usr/sbin/groupdel,/usr/bin/gpasswd, /usr/bin/passwd

tom  ALL=(ALL)  NOPASSWD: /usr/sbin/useradd, /usr/sbin/usermod, /usr/sbin/userdel, /usr/sbin/groupadd, /usr/sbin/groupmod, /usr/sbin/groupdel,/usr/bin/gpasswd, /usr/bin/passwd

jack  ALL=(ALL)  NOPASSWD: /usr/sbin/useradd, /usr/sbin/usermod, /usr/sbin/userdel, /usr/sbin/groupadd, /usr/sbin/groupmod, /usr/sbin/groupdel,/usr/bin/gpasswd, /usr/bin/passwd

【方法二：命令别名】
# User Management
Cmnd_Alias USER_ADMIN = /usr/sbin/useradd, /usr/sbin/usermod, /usr/sbin/userdel, /usr/sbin/groupadd, /usr/sbin/groupmod, /usr/sbin/groupdel, /usr/bin/gpasswd, /usr/bin/passwd

alice  ALL=(ALL)  NOPASSWD: USER_ADMIN
tom    ALL=(ALL)  NOPASSWD: USER_ADMIN
jack   ALL=(ALL)  NOPASSWD: USER_ADMIN

测试：
[alice@alice ~]$ sudo useradd user60
[alice@alice ~]$ sudo usermod -s /sbin/nologin user60
[alice@alice ~]$ sudo passwd user60
[alice@alice ~]$ sudo userdel user60
[alice@alice ~]$ sudo groupadd cloud2503
[alice@alice ~]$ sudo cat /etc/shadow
[sudo] password for alice: 
Sorry, user alice is not allowed to execute '/bin/cat /etc/shadow' as root on alice.

Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping		# 定义别名NETWROKING
tom ALL=(ALL) NETWORKING
```

```bash
- 系统默认定义好的命令别名：

# Command Aliases
## These are groups of related commands...

## Networking
# Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool

## Installation and management of software
# Cmnd_Alias SOFTWARE = /bin/rpm, /usr/bin/up2date, /usr/bin/yum

## Services
# Cmnd_Alias SERVICES = /sbin/service, /sbin/chkconfig, /usr/bin/systemctl start, /usr/bin/systemctl stop, /usr/bin/systemctl reload, /usr/bin/systemctl restart, /usr/bin/systemctl status, /usr/bin/systemctl enable, /usr/bin/systemctl disable

## Updating the locate database
# Cmnd_Alias LOCATE = /usr/bin/updatedb

## Storage
# Cmnd_Alias STORAGE = /sbin/fdisk, /sbin/sfdisk, /sbin/parted, /sbin/partprobe, /bin/mount, /bin/umount


alice  ALL=(ALL)	NOPASSWD: SOFTWARE					# SOFTWARE前面定义的命令别名
jack   ALL=(ALL)	NOPASSWD: SERVICES, SOFTWARE
```

```bash
- 建议使用方法：
[root@yangge ~]# groupadd user_admin
[root@yangge ~]# groupadd net_admin
[root@yangge ~]# groupadd storage_admin
[root@yangge ~]# groupadd software_admin
[root@yangge ~]# groupadd service_admin

[root@yangge ~]# visudo
%user_admin  	ALL=(ALL)	NOPASSWD: USER_ADMIN		# USER_ADMIN 事先定义好的命令别名
%net_admin  	ALL=(ALL)	NOPASSWD: NETWORKING		# NETWORKING 事先定义好的命令别名
%storage_admin  ALL=(ALL)	NOPASSWD: STORAGE			# STORAGE 事先定义好的命令别名
%software_admin ALL=(ALL)	NOPASSWD: SOFTWARE			# SOFTWARE 事先定义好的命令别名
%service_admin  ALL=(ALL)	NOPASSWD: SERVICES			# SERVICES 事先定义好的命令别名
```

#### 案例5：命令排除

```bash
alice   ALL=(ALL)       NOPASSWD: /usr/bin/passwd, /usr/sbin/useradd

[alice@alice ~]$ passwd tom							# 修改指定用户的密码
passwd: Only root can specify a user name.
[alice@alice ~]$ sudo passwd tom
Changing password for user tom.
New password: 
BAD PASSWORD: The password is a palindrome
Retype new password: 
passwd: all authentication tokens updated successfully.

[alice@alice ~]$ sudo passwd root					# 修改root用户的密码
Changing password for user root.
New password: 
BAD PASSWORD: The password is a palindrome
Retype new password: 
passwd: all authentication tokens updated successfully.


如果不希望修改root密码： 
alice   ALL=(ALL)       NOPASSWD: /usr/bin/passwd, !/usr/bin/passwd root,  /usr/sbin/useradd

测试：
[alice@alice ~]$ sudo passwd root
Sorry, user alice is not allowed to execute '/bin/passwd root' as root on alice.
[alice@alice ~]$ sudo passwd tom
Changing password for user tom.
New password: 
BAD PASSWORD: The password is a palindrome
Retype new password: 
passwd: all authentication tokens updated successfully.
```

### 五、Ubuntu使用sudo

```bash
默认情况下，Ubuntu visudo使用的编辑器是nano
yangge@server01:~$ sudo visudo 
Defaults editor=/usr/bin/vim

# User privilege specification
root    ALL=(ALL:ALL) ALL

# Members of the admin group may gain root privileges
%admin ALL=(ALL) ALL

# Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL

alice  ALL=(ALL) NOPASSWD: /usr/bin/vim /etc/hosts, /usr/bin/vim /etc/httpd/*.conf

01 ALL: 从任何主机
02 ALL: 以任何用户的身份，包括root用户
03 ALL: 以任何组的身份，包括root组
04 ALL: 执行任何命令
NOPASSWD: 不需要自己的密码（防止当前坐在电脑前的不是你）
```

### 六、不同用户的区别

```bash
- root
超级用户：房东

- CentOS: %wheel   ALL=(ALL) ALL
- Ubuntu: %sudo    ALL=(ALL) ALL
万能钥匙授权用户

- alice
普通用户：租客
```

